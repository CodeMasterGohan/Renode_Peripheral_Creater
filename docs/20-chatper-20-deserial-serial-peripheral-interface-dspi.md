### Chatper 20 Deserial Serial Peripheral Interface (DSPI)

## 20.1 Introduction

This chapter describes the deserial serial peripheral interface (DSPI), which provides a synchronous serial bus for communication between the MPC5553/MPC5554 and an external peripheral device.

## 20.1.1 Block Diagram

A block diagram of the DSPI is shown in Figure 20-1.

Figure 20-1. DSPI Block Diagram

<!-- image -->

## 20.1.2 Overview

The DSPI supports pin count reduction through serialization and deserialization of eTPU channels, eMIOS channels, and memory-mapped registers. Incoming serial data may be used to trigger external interrupt requests through DSPI deserialized output connections to the SIU. The channels and register content are transmitted  using  an  SPI-like  protocol.  There  are  four  identical  DSPI  modules  (DSPI\_A,  DSPI\_B, DSPI\_C, and DSPI\_D) on the MPC5554, and three DSPI modules on the MPC5553 (DSPI\_B, DSPI\_C, and DSPI\_D). The DSPI has three configurations:

- · Serial peripheral interface (SPI) configuration where the DSPI operates as an SPI with support for queues.
- · Deserial serial interface (DSI) configuration where the DSPI serializes eTPU and eMIOS output channels and deserializes the received data by placing it on the eTPU and eMIOS input channels and as inputs to the external interrupt request submodule of the SIU.
- · Combined serial interface (CSI) configuration where the DSPI operates in both SPI and DSI configurations interleaving DSI frames with SPI frames, giving priority to SPI frames.

For  queued  operations  the  SPI  queues  reside  in  internal  SRAM  which  is  external  to  the  DSPI.  Data transfers  between  the  queues  and  the  DSPI  FIFOs  are  accomplished  through  the  use  of  the  eDMA controller or through host software. Figure 20-2 shows a DSPI with external queues in internal SRAM.

Figure 20-2. DSPI with Queues and eDMA

<!-- image -->

## 20.1.3 Features

The DSPI supports these SPI features:

- · Full-duplex, three-wire synchronous transfers
- · Master and slave mode
- · Buffered transmit and receive operation using the TX and RX FIFOs, with depths of four entries
- · Visibility into TX and RX FIFOs for ease of debugging
- · FIFO bypass mode for low-latency updates to SPI queues
- · Programmable transfer attributes on a per-frame basis
- - Eight clock and transfer attribute registers
- - Serial clock with programmable polarity and phase
- - Programmable delays
- -PCS to SCK delay
- -SCK to PCS delay
- -Delay between frames
- - Programmable serial frame size of 4 to 16 bits, expandable with software control
- - Continuously held chip select capability
- · Six peripheral chip selects, expandable to 64 with external demultiplexer
- · Deglitching support for up to 32 peripheral chip selects with external demultiplexer
- · Two DMA conditions for SPI queues residing in RAM or Flash
- - TX FIFO is not full (TFFF)
- - RX FIFO is not empty (RFDF)
- · Six interrupt conditions
- -End of queue reached (EOQF)
- -TX FIFO is not full (TFFF)
- -Transfer of current frame complete (TCF)

- -RX FIFO is not empty (RFDF)
- -FIFO overrun (attempt to transmit with an empty TX FIFO or serial frame received while RX FIFO is full) (RFOF)
- -FIFO under flow (slave only and SPI mode, the slave is asked to transfer data when the TX FIFO is empty) in the MPC5553 only (TFUF)
- · Modified SPI transfer formats for communication with slower peripheral devices
- · Continuous serial communications clock (SCK)

When configured for DSI or CSI operation, the DSPI supports pin reduction through serialization and deserialization.

- · Serialized data sources
- - eTPU\_A, eTPU\_B (for the MPC5554 only), and eMIOS output channels
- - Memory-mapped register in the DSPI
- · Deserialized data destinations
- - eTPU\_A and eMIOS input channels
- - SIU external interrupt request inputs
- - Memory-mapped register in the DSPI
- · Transfer initiation conditions
- -Continuous
- -Edge sensitive hardware trigger
- -Change in data
- · Support for parallel and serial chaining of DSPI modules
- · Pin serialization/deserialization with interleaved SPI frames for control and diagnostics

## 20.1.4 Modes of Operation

The DSPI has four modes of operation. These modes can be divided into two categories; module-specific modes such as master, slave, and module disable modes, and an MCU-specific mode (debug mode).

The module-specific modes are entered by host software writing to a register. The MCU-specific mode is controlled  by  signals  external  to  the  DSPI.  The  MCU-specific  mode  is  a  mode  that  the  entire MPC5553/MPC5554 may enter, in parallel to the DSPI being in one of its module-specific modes.

## 20.1.4.1 Master Mode

Master mode allows the DSPI to initiate and control serial communication. In this mode the SCK, PCS n and  SOUT signals  are  controlled  by  the  DSPI  and  configured  as  outputs.  For  more  information,  see Section 20.4.1.1, 'Master Mode.'

## 20.1.4.2 Slave Mode

Slave mode allows the DSPI to communicate with SPI/DSI bus masters. In this mode the DSPI responds to externally controlled serial transfers. The DSPI cannot initiate serial transfers in slave mode. In slave mode, the SCK signal and the PCS0/SS signal are configured as inputs and provided by a bus master. PCS0/SS must be configured as input and pulled high.  If  the  internal  pull  up  is  being  used  then  the appropriate  bits  in  the  relevant  SIU\_PCR  must  be  set  (SIU\_PCR  [WPE=1],  [WPS=1]).  For  more information, see Section 20.4.1.2, 'Slave Mode.'

## 20.1.4.3 Module Disable Mode

The module disable mode is used for MCU power management. The clock to the non-memory mapped logic in the DSPI is stopped while in module disable mode. The DSPI enters the module disable mode when the MDIS bit in DSPI \_MCR is set. For more information, see Section 20.4.1.3, 'Module Disable x Mode.'

## 20.1.4.4 Debug Mode

Debug mode is used for system development and debugging. If the device enters debug mode while the FRZ bit in the DSPI x \_MCR is set, the DSPI halts operation on the next frame boundary. If the device enters debug mode while the FRZ bit is negated, the DSPI behavior is unaffected and remains dictated by the module-specific mode and configuration of the DSPI. For more information, see Section 20.4.1.4, 'Debug Mode.'

## 20.2 External Signal Description

## 20.2.1 Signal Overview

Table 20-1 lists off-chip DSPI signals.

Table 20-1. Signal Properties

|            |                | Function                                                 | Function             |
|------------|----------------|----------------------------------------------------------|----------------------|
| Name       | I/O Type       | Master Mode                                              | Slave Mode           |
| PCS0/SS    | Output / Input | Peripheral chip select 0                                 | Slave select         |
| PCS[1:3]   | Output         | Peripheral chip select 1-3                               | Unused 1             |
| PCS4/MTRIG | Output         | Peripheral chip select 4                                 | Master Trigger       |
| PCS5/PCSS  | Output         | Peripheral chip select 5 / Peripheral chip select strobe | Unused 1             |
| SIN        | Input          | Serial data in                                           | Serial data in       |
| SOUT       | Output         | Serial data out                                          | Serial data out      |
| SCK        | Output / Input | Serial clock (output)                                    | Serial clock (input) |

1 In the SIU the user can select alternate pin functions for the MPC5553/MPC5554.

## 20.2.2 Signal Names and Descriptions

## 20.2.2.1 Peripheral Chip Select / Slave Select (PCS0/SS )

In master mode, the PCS0 signal is a peripheral chip select output that selects the slave device to which the current transmission is intended.

In slave mode, the SS signal is a slave select input signal that allows an SPI master to select the DSPI as the target for transmission. PCS0/SS must be configured as input and pulled high. If the internal pull up is being used then the appropriate bits in the relevant SIU\_PCR must be set (SIU\_PCR [WPE=1], [WPS=1]).

The IBE and OBE bits in the corresponding SIU\_PCR need to be set appropriately for all PCSx0 pins when the DSPI chip select/slave select primary function is selected for that pin.  When the pin is to be used in DSPI master mode as a chip select output, then the OBE bit should be set.  When the pin is to be used in DSPI slave  mode  as  a  slave  select  input,  then  the  IBE  bit  should  be  set.  See  Section 6.3.1.12,  'Pad Configuration Registers (SIU\_PCR) for more information.

## 20.2.2.2 Peripheral Chip Selects 1-3 (PCS[1:3])

PCS[1:3] are peripheral chip select output signals in master mode. In slave mode these signals are not used.

## 20.2.2.3 Peripheral Chip Select 4 / Master Trigger (PCS4/MTRIG)

PCS4 is a peripheral chip select output signal in master mode. In slave mode this signal is a master trigger.

## 20.2.2.4 Peripheral Chip Select 5 / Peripheral Chip Select Strobe (PCS5/PCSS)

PCS5 is a peripheral chip select output signal. When the DSPI is in master mode and PCSSE bit in the DSPI \_MCR is negated, this signal is used to select which slave device the current transfer is intended for. x

PCSS provides a strobe signal that can be used with an external logic device for deglitching of the PCS signals. When the DSPI is in master mode and the PCSSE bit in the DSPI x \_MCR is set, the PCSS provides the appropriate timing for the decoding of the PCS[0:4] signals which prevents glitches from occurring.

PCS5/ PCSS is not used in slave mode.

## 20.2.2.5 Serial Input (SIN)

SIN is a serial data input signal.

## 20.2.2.6 Serial Output (SOUT)

SOUT is a serial data output signal.

## 20.2.2.7 Serial Clock (SCK)

SCK is a serial communication clock signal. In master mode, the DSPI generates the SCK. In slave mode, SCK is an input from an external bus master.

## 20.3 Memory Map/Register Definition

## 20.3.1 Memory Map

Table 20-2 shows the DSPI memory map.

Table 20-2. DSPI Detailed Memory Map

| Address                                                                                   | Register Name   | Register Description                                  | Size (bits)   |
|-------------------------------------------------------------------------------------------|-----------------|-------------------------------------------------------|---------------|
| Base: 0xFFF9_0000 (DSPI A) 0xFFF9_4000 (DSPI B) 0xFFF9_8000 (DSPI C) 0xFFF9_C000 (DSPI D) | DSPI x _MCR     | DSPI module configuration register                    | 32            |
| Base + 0x4                                                                                | -               | Reserved                                              | -             |
| Base + 0x8                                                                                | DSPI x _TCR     | DSPI transfer count register                          | 32            |
| Base + 0xC                                                                                | DSPI x _CTAR0   | DSPI clock and transfer attributes register 0         | 32            |
| Base + 0x10                                                                               | DSPI x _CTAR1   | DSPI clock and transfer attributes register 1         | 32            |
| Base + 0x14                                                                               | DSPI x _CTAR2   | DSPI clock and transfer attributes register 2         | 32            |
| Base + 0x18                                                                               | DSPI x _CTAR3   | DSPI clock and transfer attributes register 3         | 32            |
| Base + 0x1C                                                                               | DSPI x _CTAR4   | DSPI clock and transfer attributes register 4         | 32            |
| Base + 0x20                                                                               | DSPI x _CTAR5   | DSPI clock and transfer attributes register 5         | 32            |
| Base + 0x24                                                                               | DSPI x _CTAR6   | DSPI clock and transfer attributes register 6         | 32            |
| Base + 0x28                                                                               | DSPI x _CTAR7   | DSPI clock and transfer attributes register 7         | 32            |
| Base + 0x2C                                                                               | DSPI x _SR      | DSPI status register                                  | 32            |
| Base + 0x30                                                                               | DSPI x _RSER    | DSPI DMA/interrupt request select and enable register | 32            |
| Base + 0x34                                                                               | DSPI x _PUSHR   | DSPI push TX FIFO register                            | 32            |
| Base + 0x38                                                                               | DSPI x _POPR    | DSPI pop RX FIFO register                             | 32            |
| Base + 0x3C                                                                               | DSPI x _TXFR0   | DSPI transmit FIFO register 0                         | 32            |
| Base + 0x40                                                                               | DSPI x _TXFR1   | DSPI transmit FIFO register 1                         | 32            |
| Base + 0x44                                                                               | DSPI x _TXFR2   | DSPI transmit FIFO register 2                         | 32            |
| Base + 0x48                                                                               | DSPI x _TXFR3   | DSPI transmit FIFO register 3                         | 32            |
| Base + 0x4C- Base + 0x78                                                                  | -               | Reserved                                              | -             |
| Base + 0x7C                                                                               | DSPI x _RXFR0   | DSPI receive FIFO register 0                          | 32            |
| Base + 0x80                                                                               | DSPI x _RXFR1   | DSPI receive FIFO register 1                          | 32            |
| Base + 0x84                                                                               | DSPI x _RXFR2   | DSPI receive FIFO register 2                          | 32            |
| Base + 0x88                                                                               | DSPI x _RXFR3   | DSPI receive FIFO register 3                          | 32            |
| Base + 0x8C- Base + 0xB8                                                                  | -               | Reserved                                              | -             |
| Base + 0xBC                                                                               | DSPI x _DSICR   | DSPI DSI configuration register                       | 32            |
| Base + 0xC0                                                                               | DSPI x _SDR     | DSPI DSI serialization data register                  | 32            |
| Base + 0xC4                                                                               | DSPI x _ASDR    | DSPI DSI alternate serialization data register        | 32            |

## MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

Table 20-2. DSPI Detailed Memory Map (continued)

| Address     | Register Name   | Register Description                   |   Size (bits) |
|-------------|-----------------|----------------------------------------|---------------|
| Base + 0xC8 | DSPI x _COMPR   | DSPI DSI transmit comparison register  |            32 |
| Base + 0xCC | DSPI x _DDR     | DSPI DSI deserialization data register |            32 |

## 20.3.2 Register Descriptions

## 20.3.2.1 DSPI Module Configuration Register (DSPI x \_MCR)

The DSPI \_MCR contains bits which configure various attributes associated with DSPI operation. The x HALT and MDIS bits can be changed at any time but will only take effect on the next frame boundary. Only the HALT and MDIS bits in the DSPI \_MCR may be changed while the DSPI is running. x

Figure 20-3. DSPI Module Configuration Register (DSPI x \_MCR)

<!-- image -->

|          | 0    | 1          | 2     | 3    | 4    | 5    | 6     | 7    | 8    | 9    | 10      | 11      | 12      | 13      | 14      | 15      |
|----------|------|------------|-------|------|------|------|-------|------|------|------|---------|---------|---------|---------|---------|---------|
| R W      | MSTR | CONT_ SCKE | DCONF |      | FRZ  | MTFE | PCSSE | ROOE | 0    | 0    | PCSIS 5 | PCSIS 4 | PCSIS 3 | PCSIS 2 | PCSIS 1 | PCSIS 0 |
| Reset    | 0    | 0          | 0     | 0    | 0    | 0    | 0     | 0    | 0    | 0    | 0       | 0       | 0       | 0       | 0       | 0       |
| Reg Addr | Base | Base       | Base  | Base | Base | Base | Base  | Base | Base | Base | Base    | Base    | Base    | Base    | Base    | Base    |

<!-- image -->

|          | 16   | 17   | 18   | 19   | 20   | 21       | 22      | 23   | 24   | 25   | 26   | 27   | 28   | 29   | 30   | 31   |
|----------|------|------|------|------|------|----------|---------|------|------|------|------|------|------|------|------|------|
| R        | 0    | MDIS | DIS_ | DIS_ | CLR_ | CLR_ RXF | SMPL_PT |      | 0    | 0    | 0    | 0    | 0    | 0    | 0    | HALT |
| W        |      |      | TXF  | RXF  | TXF  |          |         |      |      |      |      |      |      |      |      |      |
| Reset    | 0    | 0    | 0    | 0    | 0    | 0        | 0       | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 1    |
| Reg Addr | Base | Base | Base | Base | Base | Base     | Base    | Base | Base | Base | Base | Base | Base | Base | Base | Base |

Table 20-3. DSPI x \_MCR Field Descriptions

|   Bits | Name      | Description                                                                                                                                                                                                            |
|--------|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      0 | MSTR      | Master/slave mode select. Configures the DSPI for either master mode or slave mode. 0 DSPI is in slave mode 1 DSPI is in master mode                                                                                   |
|      1 | CONT_SCKE | Continuous SCK enable. Enables the serial communication clock (SCK) to run continuously. See Section 20.4.8, 'Continuous Serial Communications Clock,' for details. 0 Continuous SCK disabled 1 Continuous SCK enabled |

Table 20-3. DSPI x \_MCR Field Descriptions (continued)

| Bits   | Name        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|--------|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2-3    | DCONF [0:1] | DSPI configuration. Selects between the three different configurations of the DSPI. The table below lists the DCONF values for the various configurations.                                                                                                                                                                                                                                                                                                                                                                                                                                  | DSPI configuration. Selects between the three different configurations of the DSPI. The table below lists the DCONF values for the various configurations.                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2-3    | DCONF [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | DCONF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2-3    | DCONF [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2-3    | DCONF [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2-3    | DCONF [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2-3    | DCONF [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 4      | FRZ         | Freeze. Enables the DSPI transfers to be stopped on the next frame boundary when the MPC5553/MPC5554 enters debug mode. 0 Do not halt serial transfers 1 Halt serial transfers                                                                                                                                                                                                                                                                                                                                                                                                              | Freeze. Enables the DSPI transfers to be stopped on the next frame boundary when the MPC5553/MPC5554 enters debug mode. 0 Do not halt serial transfers 1 Halt serial transfers                                                                                                                                                                                                                                                                                                                                                                                                              |
| 5      | MTFE        | Modified timing format enable. Enables a modified transfer format to be used. See Section 20.4.7.4, 'Modified SPI/DSI Transfer Format (MTFE = 1, CPHA=1),' for more information. 0 Modified SPI transfer format disabled 1 Modified SPI transfer format enabled                                                                                                                                                                                                                                                                                                                             | Modified timing format enable. Enables a modified transfer format to be used. See Section 20.4.7.4, 'Modified SPI/DSI Transfer Format (MTFE = 1, CPHA=1),' for more information. 0 Modified SPI transfer format disabled 1 Modified SPI transfer format enabled                                                                                                                                                                                                                                                                                                                             |
| 6      | PCSSE       | Peripheral chip select strobe enable. Enables the PCS5/PCSS to operate as an PCS strobe output signal. See Section 20.4.6.5, 'Peripheral Chip Select Strobe Enable (PCSS),' for more information. 0 PCS5/PCSS is used as the Peripheral chip select 5 signal 1 PCS5/PCSS is used as an active-low PCS strobe signal                                                                                                                                                                                                                                                                         | Peripheral chip select strobe enable. Enables the PCS5/PCSS to operate as an PCS strobe output signal. See Section 20.4.6.5, 'Peripheral Chip Select Strobe Enable (PCSS),' for more information. 0 PCS5/PCSS is used as the Peripheral chip select 5 signal 1 PCS5/PCSS is used as an active-low PCS strobe signal                                                                                                                                                                                                                                                                         |
| 7      | ROOE        | Receive FIFO overflow overwrite enable. Enables an RX FIFO overflow condition to either ignore the incoming serial data or to overwrite existing data. If the RX FIFO is full and new data is received, the data from the transfer that generated the overflow is either ignored or shifted in to the shift register. If the ROOE bit is asserted, the incoming data is shifted in to the shift register. If the ROOEbit is negated, the incoming data is ignored. See Section 20.4.9.6, 'Receive FIFO Overflow Interrupt Request (RFOF),' for more information. 0 Incoming data is ignored | Receive FIFO overflow overwrite enable. Enables an RX FIFO overflow condition to either ignore the incoming serial data or to overwrite existing data. If the RX FIFO is full and new data is received, the data from the transfer that generated the overflow is either ignored or shifted in to the shift register. If the ROOE bit is asserted, the incoming data is shifted in to the shift register. If the ROOEbit is negated, the incoming data is ignored. See Section 20.4.9.6, 'Receive FIFO Overflow Interrupt Request (RFOF),' for more information. 0 Incoming data is ignored |
| 8-9    | -           | Reserved, but implemented. These bits are writable, but have no effect.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Reserved, but implemented. These bits are writable, but have no effect.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 10-15  | PCSIS n     | Peripheral chip select inactive state. Determines the inactive state of the PCS n signal. PCS0/SS must be configured as inactive high for slave mode operation. 0 The inactive state of PCS n is low 1 The inactive state of PCS n is high                                                                                                                                                                                                                                                                                                                                                  | Peripheral chip select inactive state. Determines the inactive state of the PCS n signal. PCS0/SS must be configured as inactive high for slave mode operation. 0 The inactive state of PCS n is low 1 The inactive state of PCS n is high                                                                                                                                                                                                                                                                                                                                                  |
| 16     | -           | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 17     | MDIS        | Module disable. Allows the clock to be stopped to the non-memory mapped logic in the DSPI effectively putting the DSPI in a software controlled power-saving state. See Section 20.4.10, 'Power Saving Features for more information.' The reset value of the MDIS bit is parameterized, with a default reset value of 0. 0 Enable DSPI clocks 1 Allow external logic to disable DSPI clocks                                                                                                                                                                                                | Module disable. Allows the clock to be stopped to the non-memory mapped logic in the DSPI effectively putting the DSPI in a software controlled power-saving state. See Section 20.4.10, 'Power Saving Features for more information.' The reset value of the MDIS bit is parameterized, with a default reset value of 0. 0 Enable DSPI clocks 1 Allow external logic to disable DSPI clocks                                                                                                                                                                                                |

## MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

Table 20-3. DSPI x \_MCR Field Descriptions (continued)

| Bits   | Name          | Description                                                                                                                                                                                                                                                                          |
|--------|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 18     | DIS_TXF       | Disable transmit FIFO. Provides a mechanism to disable the TX FIFO. When the TX FIFO is disabled, the transmit part of the DSPI operates as a simplified double-buffered SPI. See Section 20.4.3.3, 'FIFO Disable Operation for details.' 0 TX FIFO is enabled 1 TX FIFO is disabled |
| 19     | DIS_RXF       | Disable receive FIFO. Provides a mechanism to disable the RX FIFO. When the RX FIFO is disabled, the receive part of the DSPI operates as a simplified double-buffered SPI. See Section 20.4.3.3, 'FIFO Disable Operation for details.' 0 RX FIFO is enabled 1 RX FIFO is disabled   |
| 20     | CLR_TXF       | Clear TX FIFO. Flushes the TX FIFO. Writing a 1 to CLR_TXF clears the TX FIFO counter. The CLR_TXF bit is always read as zero. 0 Do not clear the TX FIFO counter 1 Clear the TX FIFO counter                                                                                        |
| 21     | CLR_RXF       | Clear RXFIFO. Flushes the RXFIFO. Writing a 1 to CLR_RXF clears the RXcounter. The CLR_RXF bit is always read as zero. 0 Do not clear the RX FIFO counter 1 Clear the RX FIFO counter                                                                                                |
| 22-23  | SMPL_PT [0:1] | Sample point. Allows the host software to select when the DSPI master samples SIN in modified transfer format. Figure 20-38 shows where the master can sample the SIN pin. The table below lists the various delayed sample points.                                                  |
| 22-23  | SMPL_PT [0:1] |                                                                                                                                                                                                                                                                                      |
| 22-23  | SMPL_PT [0:1] |                                                                                                                                                                                                                                                                                      |
| 22-23  | SMPL_PT [0:1] |                                                                                                                                                                                                                                                                                      |
| 22-23  | SMPL_PT [0:1] |                                                                                                                                                                                                                                                                                      |
| 22-23  | SMPL_PT [0:1] |                                                                                                                                                                                                                                                                                      |
| 24-30  | -             | Reserved.                                                                                                                                                                                                                                                                            |
| 31     | HALT          | Halt. Provides a mechanism for software to start and stop DSPI transfers. See Section 20.4.2, 'Start and Stop of DSPI Transfers,' for details on the operation of this bit. 0 Start transfers 1 Stop transfers                                                                       |

## 20.3.2.2 DSPI Transfer Count Register (DSPI x \_TCR)

The DSPI \_TCR contains a counter that indicates the number of SPI transfers made. The transfer counter x is intended to assist in queue management. The user must not write to the DSPI x \_TCR while the DSPI is running.

Figure 20-4. DSPI Transfer Count Register (DSPI x \_TCR)

<!-- image -->

Table 20-4. DSPI x \_TCR Field Descriptions

| Bits   | Name            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|--------|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0-15   | SPI_TCNT [0:15] | SPI transfer counter. Counts the number of SPI transfers the DSPI makes. The SPI_TCNT field is incremented every time the last bit of an SPI frame is transmitted. A value written to SPI_TCNT presets the counter to that value. SPI_TCNT is reset to zero at the beginning of the frame when the CTCNT field is set in the executing SPI command. The transfer counter 'wraps around,' incrementing the counter past 65535 resets the counter to zero. |
| 16-31  | -               | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                |

## 20.3.2.3 DSPI Clock and Transfer Attributes Registers 0-7 (DSPI x \_CTAR ) n

The  MPC5553/MPC5554  DSPI  modules  each  contain  eight  clock  and  transfer  attribute  registers (DSPI \_CTAR ) which are used to define different transfer attribute configurations. Each DSPI x n x \_CTAR controls:

- · Frame size
- · Baud rate and transfer delay values
- · Clock phase
- · Clock polarity
- · MSB/LSB first

DSPI \_CTARs  support  compatibility  with  the  QSPI  module  in  the  MPC5xx  family  of  MCUs.  See x Section 20.5.4,  'MPC5xx  QSPI  Compatibility  with  the  DSPI,'  for  a  discussion  on  DSPI/QSPI compatibility.  At  the  initiation  of  an  SPI  or  DSI  transfer,  control  logic  selects  the  DSPI x \_CTAR that contains the transfer's attributes. The user must not write to the DSPI x \_CTARs while the DSPI is running.

In master mode, the DSPI x \_CTAR  registers define combinations of transfer attributes such as frame size, n clock phase and polarity, data bit ordering, baud rate, and various delays. In slave mode, a subset of the bit fields in the DSPI x \_CTAR0 and DSPI \_CTAR1 registers are used to set the slave transfer attributes. See x the individual bit descriptions for details on which bits are used in slave modes.

When the DSPI is configured as an SPI master, the CTAS field in the command portion of the TX FIFO entry  selects  which  of  the  DSPI x \_CTAR  registers  is  used  on  a  per-frame  basis.  When  the  DSPI  is configured as an SPI bus slave, the DSPI x \_CTAR0 register is used.

When the DSPI is configured as a DSI master, the DSICTAS field in the DSPI DSI configuration register (DSPI \_DSICR)  selects  which  of  the  DSPI x x \_CTAR  register  is  used.  For  more  information  on  the DSPI \_DSICR see Section 20.3.2.10, 'DSPI DSI Configuration Register (DSPIx\_DSICR).' When the x DSPI is configured as a DSI bus slave, the DSPI x \_CTAR1 register is used.

In CSI configuration, the transfer attributes are selected based on whether the current frame is SPI data or DSI data. SPI transfers in CSI configuration follow the protocol described for SPI configuration, and DSI transfers in CSI configuration follow the protocol described for DSI configuration. CSI configuration is only  valid  in  conjunction  with  master  mode.  See  Section 20.4.5,  'Combined  Serial  Interface  (CSI) Configuration' for more details.

.

Figure 20-5. DSPI Clock and Transfer Attributes Registers 0-7 (DSPI x \_CTARn)

<!-- image -->

## Table 20-5. DSPI x \_CTAR n Field Description

| Bits   | Name       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------|------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0      | DBR        | Double baud rate. The DBR bit doubles the effective baud rate of the serial communications clock (SCK). This field is only used in master mode. It effectively halves the baud rate division ratio supporting faster frequencies and odd division ratios for the serial communications clock (SCK). When the DBRbit is set, the duty cycle of the serial communications clock (SCK) depends on the value in the baud rate prescaler and the clock phase bit as listed below. See the BR field below and Section 20.4.6.1, 'Baud Rate Generator' for details on how to compute the baud rate. If the overall baud rate is divide by two or divide by three of the system clock then the continuous SCKenable or the modified timing format enable bits must not be set. 0 The baud rate is computed normally with a 50/50 duty cycle 1 Baud rate is doubled with the duty cycle depending on the baud rate prescaler | Double baud rate. The DBR bit doubles the effective baud rate of the serial communications clock (SCK). This field is only used in master mode. It effectively halves the baud rate division ratio supporting faster frequencies and odd division ratios for the serial communications clock (SCK). When the DBRbit is set, the duty cycle of the serial communications clock (SCK) depends on the value in the baud rate prescaler and the clock phase bit as listed below. See the BR field below and Section 20.4.6.1, 'Baud Rate Generator' for details on how to compute the baud rate. If the overall baud rate is divide by two or divide by three of the system clock then the continuous SCKenable or the modified timing format enable bits must not be set. 0 The baud rate is computed normally with a 50/50 duty cycle 1 Baud rate is doubled with the duty cycle depending on the baud rate prescaler | Double baud rate. The DBR bit doubles the effective baud rate of the serial communications clock (SCK). This field is only used in master mode. It effectively halves the baud rate division ratio supporting faster frequencies and odd division ratios for the serial communications clock (SCK). When the DBRbit is set, the duty cycle of the serial communications clock (SCK) depends on the value in the baud rate prescaler and the clock phase bit as listed below. See the BR field below and Section 20.4.6.1, 'Baud Rate Generator' for details on how to compute the baud rate. If the overall baud rate is divide by two or divide by three of the system clock then the continuous SCKenable or the modified timing format enable bits must not be set. 0 The baud rate is computed normally with a 50/50 duty cycle 1 Baud rate is doubled with the duty cycle depending on the baud rate prescaler | Double baud rate. The DBR bit doubles the effective baud rate of the serial communications clock (SCK). This field is only used in master mode. It effectively halves the baud rate division ratio supporting faster frequencies and odd division ratios for the serial communications clock (SCK). When the DBRbit is set, the duty cycle of the serial communications clock (SCK) depends on the value in the baud rate prescaler and the clock phase bit as listed below. See the BR field below and Section 20.4.6.1, 'Baud Rate Generator' for details on how to compute the baud rate. If the overall baud rate is divide by two or divide by three of the system clock then the continuous SCKenable or the modified timing format enable bits must not be set. 0 The baud rate is computed normally with a 50/50 duty cycle 1 Baud rate is doubled with the duty cycle depending on the baud rate prescaler |
|        |            | DBR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | CPHA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | PBR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | SCK Duty Cycle                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|        |            | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | any                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | any                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 50/50                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 50/50                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 33/66                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 40/60                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 43/57                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 50/50                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 66/33                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 60/40                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|        |            | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 57/43                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 1-4    | FMSZ [0:3] | FMSZ. Selects the number of bits transferred per frame. The FMSZ field is used in master mode and slave mode. The table below lists the frame sizes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | FMSZ. Selects the number of bits transferred per frame. The FMSZ field is used in master mode and slave mode. The table below lists the frame sizes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | FMSZ. Selects the number of bits transferred per frame. The FMSZ field is used in master mode and slave mode. The table below lists the frame sizes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | FMSZ. Selects the number of bits transferred per frame. The FMSZ field is used in master mode and slave mode. The table below lists the frame sizes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|        |            | FMSZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Framesize                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | FMSZ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Framesize                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|        |            | 0000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 1000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|        |            | 0001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 1001                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |            | 0010                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Reserved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 1010                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |            | 0011                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1011                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 12                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |            | 0100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1100                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |            | 0101                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1101                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 14                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |            | 0110                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1110                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 15                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |            | 0111                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 1111                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 16                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table 20-5. DSPI x \_CTAR n Field Description  (continued)

| Bits   | Name         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5      | CPOL         | Clock polarity. Selects the inactive state of the serial communications clock (SCK). This bit is used in both master and slave mode. For successful communication between serial devices, the devices must have identical clock polarities. When the continuous selection format is selected (CONT = 1 or DCONT = 1), switching between clock polarities without stopping the DSPI can cause errors in the transfer due to the peripheral device interpreting the switch of clock polarity as a valid clock edge. For more information on continuous selection format, refer to Section 20.4.7.5, 'Continuous Selection Format.' 0 The inactive state value of SCK is low | Clock polarity. Selects the inactive state of the serial communications clock (SCK). This bit is used in both master and slave mode. For successful communication between serial devices, the devices must have identical clock polarities. When the continuous selection format is selected (CONT = 1 or DCONT = 1), switching between clock polarities without stopping the DSPI can cause errors in the transfer due to the peripheral device interpreting the switch of clock polarity as a valid clock edge. For more information on continuous selection format, refer to Section 20.4.7.5, 'Continuous Selection Format.' 0 The inactive state value of SCK is low |
| 6      | CPHA         | Clock phase. Selects which edge of SCK causes data to change and which edge causes data to be captured. This bit is used in both master and slave mode. For successful communication between serial devices, the devices must have identical clock phase settings. 0 Data is captured on the leading edge of SCK and changed on the following edge 1 Data is changed on the leading edge of SCK and captured on the following edge                                                                                                                                                                                                                                        | Clock phase. Selects which edge of SCK causes data to change and which edge causes data to be captured. This bit is used in both master and slave mode. For successful communication between serial devices, the devices must have identical clock phase settings. 0 Data is captured on the leading edge of SCK and changed on the following edge 1 Data is changed on the leading edge of SCK and captured on the following edge                                                                                                                                                                                                                                        |
| 7      | LSBFE        | LSB first enable. Selects if the LSB or MSB of the frame is transferred first. This bit is only used in master mode. 0 Data is transferred MSB first 1 Data is transferred LSB first                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | LSB first enable. Selects if the LSB or MSB of the frame is transferred first. This bit is only used in master mode. 0 Data is transferred MSB first 1 Data is transferred LSB first                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 8-9    | PCSSCK [0:1] | PCS to SCK delay prescaler. Selects the prescaler value for the delay between assertion of PCS and the first edge of the SCK. This field is only used in master mode. The table below lists the prescaler values. The description for bitfeild CSSCK in Table 20-5 details how to compute the PCS to SCK delay.                                                                                                                                                                                                                                                                                                                                                           | PCS to SCK delay prescaler. Selects the prescaler value for the delay between assertion of PCS and the first edge of the SCK. This field is only used in master mode. The table below lists the prescaler values. The description for bitfeild CSSCK in Table 20-5 details how to compute the PCS to SCK delay.                                                                                                                                                                                                                                                                                                                                                           |
| 8-9    | PCSSCK [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | PCSSCK                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 8-9    | PCSSCK [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 8-9    | PCSSCK [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 8-9    | PCSSCK [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 8-9    | PCSSCK [0:1] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 10-11  | PASC [0:1]   | After SCK delay prescaler. Selects the prescaler value for the delay between the last edge of SCKand the negation of PCS. This field is only used in master mode. The table below lists the prescaler values. The description for bitfeild ASC in Table 20-5 details                                                                                                                                                                                                                                                                                                                                                                                                      | After SCK delay prescaler. Selects the prescaler value for the delay between the last edge of SCKand the negation of PCS. This field is only used in master mode. The table below lists the prescaler values. The description for bitfeild ASC in Table 20-5 details                                                                                                                                                                                                                                                                                                                                                                                                      |
| 10-11  | PASC [0:1]   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | PASC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 10-11  | PASC [0:1]   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 10-11  | PASC [0:1]   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 10-11  | PASC [0:1]   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 10-11  | PASC [0:1]   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

Table 20-5. DSPI x \_CTAR n Field Description  (continued)

| Bits   | Name      | Description                                                                                                                                                                                                                                                                                                                                                                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12-13  | PDT [0:1] | Delay after transfer prescaler. The PDT field selects the prescaler value for the delay between the negation of the PCS signal at the end of a frame and the assertion of PCS at the beginning of the next frame. The PDTfield is only used in master mode. The table below lists the prescaler values. The description for bitfield DTin Table 20-5 details how to compute the delay after transfer.                                               | Delay after transfer prescaler. The PDT field selects the prescaler value for the delay between the negation of the PCS signal at the end of a frame and the assertion of PCS at the beginning of the next frame. The PDTfield is only used in master mode. The table below lists the prescaler values. The description for bitfield DTin Table 20-5 details how to compute the delay after transfer.                                               |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | PDT                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 14-15  | PBR [0:1] | Baud rate prescaler. Selects the prescaler value for the baud rate. This field is only used in master mode. The baud rate is the frequency of the serial communications clock (SCK). The system clock is divided by the prescaler value before the baud rate selection takes place. The baud rate prescaler values are listed in the table below. The description for Section 20.4.6.1, 'Baud Rate Generator' details how to compute the baud rate. | Baud rate prescaler. Selects the prescaler value for the baud rate. This field is only used in master mode. The baud rate is the frequency of the serial communications clock (SCK). The system clock is divided by the prescaler value before the baud rate selection takes place. The baud rate prescaler values are listed in the table below. The description for Section 20.4.6.1, 'Baud Rate Generator' details how to compute the baud rate. |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | PBR                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 00                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 01                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 10                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 11                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

Table 20-5. DSPI x \_CTAR n Field Description  (continued)

| Bits   | Name        | Description                                                                                                                                                                                                                                                               | Description                                                                                                                                                                                                                                                               | Description                                                                                                                                                                                                                                                               |
|--------|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 16-19  | CSSCK [0:3] | PCS to SCK delay scaler. Selects the scaler value for the PCS to SCK delay. This field is only used in master mode. The PCS to SCK delay is the delay between the assertion of PCS and the first edge of the SCK. The table below lists the scaler values.                | PCS to SCK delay scaler. Selects the scaler value for the PCS to SCK delay. This field is only used in master mode. The PCS to SCK delay is the delay between the assertion of PCS and the first edge of the SCK. The table below lists the scaler values.                | PCS to SCK delay scaler. Selects the scaler value for the PCS to SCK delay. This field is only used in master mode. The PCS to SCK delay is the delay between the assertion of PCS and the first edge of the SCK. The table below lists the scaler values.                |
|        |             |                                                                                                                                                                                                                                                                           | CSSCK                                                                                                                                                                                                                                                                     | PCS to SCK Delay Scaler Value                                                                                                                                                                                                                                             |
|        |             |                                                                                                                                                                                                                                                                           | 0000                                                                                                                                                                                                                                                                      | 2                                                                                                                                                                                                                                                                         |
|        |             |                                                                                                                                                                                                                                                                           | 0001                                                                                                                                                                                                                                                                      | 4                                                                                                                                                                                                                                                                         |
|        |             |                                                                                                                                                                                                                                                                           | 0010                                                                                                                                                                                                                                                                      | 8                                                                                                                                                                                                                                                                         |
|        |             |                                                                                                                                                                                                                                                                           | 0011                                                                                                                                                                                                                                                                      | 16                                                                                                                                                                                                                                                                        |
|        |             |                                                                                                                                                                                                                                                                           | 0100                                                                                                                                                                                                                                                                      | 32                                                                                                                                                                                                                                                                        |
|        |             |                                                                                                                                                                                                                                                                           | 0101                                                                                                                                                                                                                                                                      | 64                                                                                                                                                                                                                                                                        |
|        |             |                                                                                                                                                                                                                                                                           | 0110                                                                                                                                                                                                                                                                      | 128                                                                                                                                                                                                                                                                       |
|        |             |                                                                                                                                                                                                                                                                           | 0111                                                                                                                                                                                                                                                                      | 256                                                                                                                                                                                                                                                                       |
|        |             | The PCS to SCK delay is a multiple of the system clock period and it is computed according to the following equation: Note: See Section 20.4.6.2, 'PCS to SCK Delay (tCSC),' for more details. t CSC 1 f SYS ------ ----- PCSSCK Prescaler value CSSCK Scaler value × × = | The PCS to SCK delay is a multiple of the system clock period and it is computed according to the following equation: Note: See Section 20.4.6.2, 'PCS to SCK Delay (tCSC),' for more details. t CSC 1 f SYS ------ ----- PCSSCK Prescaler value CSSCK Scaler value × × = | The PCS to SCK delay is a multiple of the system clock period and it is computed according to the following equation: Note: See Section 20.4.6.2, 'PCS to SCK Delay (tCSC),' for more details. t CSC 1 f SYS ------ ----- PCSSCK Prescaler value CSSCK Scaler value × × = |

Table 20-5. DSPI x \_CTAR n Field Description  (continued)

| Bits   | Name      | Description                                                                                                                                                                                                                                       | Description                                                                                                                                                                                                                                       | Description                                                                                                                                                                                                                                       |
|--------|-----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 20-23  | ASC [0:3] | After SCK delay scaler. Selects the scaler value for the After SCK delay. This field is only used in master mode. The after SCK delay is the delay between the last edge of SCK and the negation of PCS. The table below lists the scaler values. | After SCK delay scaler. Selects the scaler value for the After SCK delay. This field is only used in master mode. The after SCK delay is the delay between the last edge of SCK and the negation of PCS. The table below lists the scaler values. | After SCK delay scaler. Selects the scaler value for the After SCK delay. This field is only used in master mode. The after SCK delay is the delay between the last edge of SCK and the negation of PCS. The table below lists the scaler values. |
|        |           |                                                                                                                                                                                                                                                   | ASC                                                                                                                                                                                                                                               | After SCK Delay Scaler Value                                                                                                                                                                                                                      |
|        |           |                                                                                                                                                                                                                                                   | 0000                                                                                                                                                                                                                                              | 2                                                                                                                                                                                                                                                 |
|        |           |                                                                                                                                                                                                                                                   | 0001                                                                                                                                                                                                                                              | 4                                                                                                                                                                                                                                                 |
|        |           |                                                                                                                                                                                                                                                   | 0010                                                                                                                                                                                                                                              | 8                                                                                                                                                                                                                                                 |
|        |           |                                                                                                                                                                                                                                                   | 0011                                                                                                                                                                                                                                              | 16                                                                                                                                                                                                                                                |
|        |           |                                                                                                                                                                                                                                                   | 0100                                                                                                                                                                                                                                              | 32                                                                                                                                                                                                                                                |
|        |           |                                                                                                                                                                                                                                                   | 0101                                                                                                                                                                                                                                              | 64                                                                                                                                                                                                                                                |
|        |           |                                                                                                                                                                                                                                                   | 0110                                                                                                                                                                                                                                              | 128                                                                                                                                                                                                                                               |
|        |           |                                                                                                                                                                                                                                                   | 0111                                                                                                                                                                                                                                              | 256                                                                                                                                                                                                                                               |
|        |           | The after SCK delay is a multiple of the system clock period, and it is computed according to the following equation: t ASC 1 t SYS ------ ----- PASC Prescaler value ASC Scaler value × × =                                                      | The after SCK delay is a multiple of the system clock period, and it is computed according to the following equation: t ASC 1 t SYS ------ ----- PASC Prescaler value ASC Scaler value × × =                                                      | The after SCK delay is a multiple of the system clock period, and it is computed according to the following equation: t ASC 1 t SYS ------ ----- PASC Prescaler value ASC Scaler value × × =                                                      |

## Table 20-5. DSPI x \_CTAR n Field Description  (continued)

| Bits   | Name     | Description                                                                                                                                                                                                                                                                                                                      | Description                                                                                                                                                                                                                                                                                                                      | Description                                                                                                                                                                                                                                                                                                                      |
|--------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 24-27  | DT [0:3] | Delay after transfer scaler. The DT field selects the delay after transfer scaler. This field is only used in master mode. The delay after transfer is the time between the negation of the PCSsignal at the end of a frame and the assertion of PCSat the beginning of the next frame. The table below lists the scaler values. | Delay after transfer scaler. The DT field selects the delay after transfer scaler. This field is only used in master mode. The delay after transfer is the time between the negation of the PCSsignal at the end of a frame and the assertion of PCSat the beginning of the next frame. The table below lists the scaler values. | Delay after transfer scaler. The DT field selects the delay after transfer scaler. This field is only used in master mode. The delay after transfer is the time between the negation of the PCSsignal at the end of a frame and the assertion of PCSat the beginning of the next frame. The table below lists the scaler values. |
|        |          |                                                                                                                                                                                                                                                                                                                                  | DT                                                                                                                                                                                                                                                                                                                               | Delay after Transfer Scaler Value                                                                                                                                                                                                                                                                                                |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0000                                                                                                                                                                                                                                                                                                                             | 2                                                                                                                                                                                                                                                                                                                                |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0001                                                                                                                                                                                                                                                                                                                             | 4                                                                                                                                                                                                                                                                                                                                |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0010                                                                                                                                                                                                                                                                                                                             | 8                                                                                                                                                                                                                                                                                                                                |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0011                                                                                                                                                                                                                                                                                                                             | 16                                                                                                                                                                                                                                                                                                                               |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0100                                                                                                                                                                                                                                                                                                                             | 32                                                                                                                                                                                                                                                                                                                               |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0101                                                                                                                                                                                                                                                                                                                             | 64                                                                                                                                                                                                                                                                                                                               |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0110                                                                                                                                                                                                                                                                                                                             | 128                                                                                                                                                                                                                                                                                                                              |
|        |          |                                                                                                                                                                                                                                                                                                                                  | 0111                                                                                                                                                                                                                                                                                                                             | 256                                                                                                                                                                                                                                                                                                                              |
|        |          | The delay after transfer is a multiple of the system clock period and it is computed according to the following equation: t DT 1 ------ ----- PDT Prescaler value DT Scaler value × × =                                                                                                                                          | The delay after transfer is a multiple of the system clock period and it is computed according to the following equation: t DT 1 ------ ----- PDT Prescaler value DT Scaler value × × =                                                                                                                                          | The delay after transfer is a multiple of the system clock period and it is computed according to the following equation: t DT 1 ------ ----- PDT Prescaler value DT Scaler value × × =                                                                                                                                          |

Table 20-5. DSPI x \_CTAR n Field Description  (continued)

| Bits   | Name     | Description                                                                                                                                                                                                                                                   | Description                                                                                                                                                                                                                                                   | Description                                                                                                                                                                                                                                                   |
|--------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 28-31  | BR [0:3] | Baud rate scaler. Selects the scaler value for the baud rate. This field is only used in master mode. The pre-scaled system clock is divided by the baud rate scaler to generate the frequency of the SCK. The table below lists the baud rate scaler values. | Baud rate scaler. Selects the scaler value for the baud rate. This field is only used in master mode. The pre-scaled system clock is divided by the baud rate scaler to generate the frequency of the SCK. The table below lists the baud rate scaler values. | Baud rate scaler. Selects the scaler value for the baud rate. This field is only used in master mode. The pre-scaled system clock is divided by the baud rate scaler to generate the frequency of the SCK. The table below lists the baud rate scaler values. |
|        |          |                                                                                                                                                                                                                                                               | BR                                                                                                                                                                                                                                                            | BaudRateScaler Value                                                                                                                                                                                                                                          |
|        |          |                                                                                                                                                                                                                                                               | 0000                                                                                                                                                                                                                                                          | 2                                                                                                                                                                                                                                                             |
|        |          |                                                                                                                                                                                                                                                               | 0001                                                                                                                                                                                                                                                          | 4                                                                                                                                                                                                                                                             |
|        |          |                                                                                                                                                                                                                                                               | 0010                                                                                                                                                                                                                                                          | 6                                                                                                                                                                                                                                                             |
|        |          |                                                                                                                                                                                                                                                               | 0011                                                                                                                                                                                                                                                          | 8                                                                                                                                                                                                                                                             |
|        |          |                                                                                                                                                                                                                                                               | 0100                                                                                                                                                                                                                                                          | 16                                                                                                                                                                                                                                                            |
|        |          |                                                                                                                                                                                                                                                               | 0101                                                                                                                                                                                                                                                          | 32                                                                                                                                                                                                                                                            |
|        |          |                                                                                                                                                                                                                                                               | 0110                                                                                                                                                                                                                                                          | 64                                                                                                                                                                                                                                                            |
|        |          |                                                                                                                                                                                                                                                               | 0111                                                                                                                                                                                                                                                          | 128                                                                                                                                                                                                                                                           |
|        |          | The baud rate is computed according to the following equation:                                                                                                                                                                                                | The baud rate is computed according to the following equation:                                                                                                                                                                                                | The baud rate is computed according to the following equation:                                                                                                                                                                                                |
|        |          | Note: See Section 20.4.6.1, 'Baud Rate Generator,' for more details. SCK baud rate f SYS PBRPrescalerValue ----------------------------- ----------------------------- 1 DBR + BRScalerValue ---------------------- ---------------------- × =                | Note: See Section 20.4.6.1, 'Baud Rate Generator,' for more details. SCK baud rate f SYS PBRPrescalerValue ----------------------------- ----------------------------- 1 DBR + BRScalerValue ---------------------- ---------------------- × =                | Note: See Section 20.4.6.1, 'Baud Rate Generator,' for more details. SCK baud rate f SYS PBRPrescalerValue ----------------------------- ----------------------------- 1 DBR + BRScalerValue ---------------------- ---------------------- × =                |

## 20.3.2.4 DSPI Status Register (DSPI x \_SR)

The DSPI \_SR contains status and flag bits.  The  bits  reflect  the  status  of  the  DSPI  and  indicate  the x occurrence of events that can generate interrupt or DMA requests. Software can clear flag bits in the DSPI \_SR by writing a 1 to it. Writing a 0 to a flag bit has no effect. x

Figure 20-6. DSPI Status Register (DSPI x \_SR)

<!-- image -->

|          | 0           | 1           | 2           | 3           | 4           | 5           | 6           | 7           | 8           | 9           | 10          | 11          | 12          | 13          | 14          | 15          |
|----------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| R        | TCF         | TXRXS       | 0           | EOQF        | TFUF        | 0           | TFFF        | 0           | 0           | 0           | 0           | 0           | RFOF        | 0           | RFDF        | 0           |
| W        | w1c         | w1c         |             | w1c         | w1c         |             | w1c         |             |             |             |             |             | w1c         |             | w1c         |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 1           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C |
|          | 16          | 17          | 18          | 19          | 20          | 21          | 22          | 23          | 24          | 25          | 26          | 27          | 28          | 29          | 30          | 31          |
| R        | TXCTR       | TXCTR       | TXCTR       | TXCTR       | TXNXTPTR    | TXNXTPTR    | TXNXTPTR    | TXNXTPTR    | RXCTR       | RXCTR       | RXCTR       | RXCTR       | POPNXTPTR   | POPNXTPTR   | POPNXTPTR   | POPNXTPTR   |
| W        |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C | Base + 0x2C |

## MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

## Table 20-6. DSPI x \_SR Field Descriptions

| Bits   | Name   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|--------|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0      | TCF    | Transfer complete flag. Indicates that all bits in a frame have been shifted out. The TCF bit is set after the last incoming databit is sampled, but before the tASC delay starts. Refer to Section 20.4.7.1, 'Classic SPI Transfer Format (CPHA = 0)' for details. The TCF bit is cleared by writing 1 to it. 0 Transfer not complete 1 Transfer complete                                                                                                                                                                                                                                           |
| 1      | TXRXS  | TX and RX status. Reflects the status of the DSPI. See Section 20.4.2, 'Start and Stop of DSPI Transfers' for information on what causes this bit to be negated or asserted. TXRXS is cleared by writing 1 to it. 0 TX and RX operations are disabled (DSPI is in STOPPED state) 1 TX and RX operations are enabled (DSPI is in RUNNING state)                                                                                                                                                                                                                                                       |
| 2      | -      | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 3      | EOQF   | End of queue flag. Indicates that transmission in progress is the last entry in a queue. The EOQF bit is set when the TX FIFO entry has the EOQ bit set in the command halfword and after the last incoming databit is sampled, but before the tASC delay starts. Refer to Section 20.4.7.1, 'Classic SPI Transfer Format (CPHA = 0)' for details. The EOQF bit is cleared by writing 1 to it. When the EOQF bit is set, the TXRXS bit is automatically cleared. 0 EOQ is not set in the executing command 1 EOQ bit is set in the executing SPI command Note: EOQF does not function in slave mode. |
| 4      | TFUF   | Transmit FIFO underflow flag. Indicates that an underflow condition in the TX FIFO has occurred. The transmit underflow condition is detected only for DSPI modules operating in slave mode and SPI configuration. The TFUF bit is set when the TX FIFO of a DSPI operating in SPI slave mode is empty, and a transfer is initiated by an external SPI master. The TFUF bit is cleared by writing 1 to it. 0 TX FIFO underflow has not occurred 1 TX FIFO underflow has occurred                                                                                                                     |
| 5      | -      | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 6      | TFFF   | Transmit FIFO fill flag: indicates that the TX FIFO can be filled. Provides a method for the DSPI to request more entries to be added to the TX FIFO. The TFFF bit is set while the TX FIFO is not full. The TFFF bit can be cleared by writing 1 to it or by an acknowledgement from the eDMA controller when the TX FIFO is full. 0 TX FIFO is full 1 TX FIFO is not full                                                                                                                                                                                                                          |
| 7-11   | -      | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 12     | RFOF   | Receive FIFO overflow flag. Indicates that an overflow condition in the RX FIFO has occurred. The bit is set when the RX FIFO and shift register are full and a transfer is initiated. The bit is cleared by writing 1 to it. 0 RX FIFO overflow has not occurred 1 RX FIFO overflow has occurred                                                                                                                                                                                                                                                                                                    |
| 13     | -      | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

## MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

Table 20-6. DSPI x \_SR Field Descriptions (continued)

| Bits   | Name            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|--------|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 14     | RFDF            | Receive FIFO drain flag: indicates that the RX FIFO can be drained. Provides a method for the DSPI to request that entries be removed from the RX FIFO. The bit is set while the RX FIFO is not empty. The RFDF bit can be cleared by writing 1 to it or by an acknowledgement from the eDMA controller when the RX FIFO is empty. 0 RX FIFO is empty 1 RX FIFO is not empty Note: In the interrupt service routine, RFDF must be cleared only after the DSPIx_POPR register is read. |
| 15     | -               | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 16-19  | TXCTR [0:3]     | TX FIFO counter. Indicates the number of valid entries in the TX FIFO. The TXCTR is incremented every time the DSPI _PUSHR is written. The TXCTR is decremented every time an SPI command is executed and the SPI data is transferred to the shift register.                                                                                                                                                                                                                          |
| 20-23  | TXNXTPTR [0:3]  | Transmit next pointer. Indicates which TX FIFO Entry will be transmitted during the next transfer. The TXNXTPTR field is updated every time SPI data is transferred from the TX FIFO to the shift register. See Section 20.4.3.4, 'Transmit First In First Out (TX FIFO) Buffering Mechanism' for more details.                                                                                                                                                                       |
| 24-27  | RXCTR [0:3]     | RX FIFO counter. Indicates the number of entries in the RX FIFO. The RXCTR is decremented every time the DSPI _POPR is read. The RXCTR is incremented after the last incoming databit is sampled, but before the tASC delay starts. Refer to Section 20.4.7.1, 'Classic SPI Transfer Format (CPHA = 0)' for details.                                                                                                                                                                  |
| 28-31  | POPNXTPTR [0:3] | Pop next pointer. Contains a pointer to the RX FIFO entry that will be returned when the DSPI x _POPR is read. The POPNXTPTR is updated when the DSPI x _POPR is read. See Section 20.4.3.5, 'Receive First In First Out (RX FIFO) Buffering Mechanism' for more details.                                                                                                                                                                                                             |

## 20.3.2.5 DSPI DMA/Interrupt Request Select and Enable Register (DSPI x \_RSER)

The DSPI \_RSER serves two purposes. It enables flag bits in the DSPI x x \_SR to generate DMA requests or interrupt requests. The DSPI x \_RSER also selects the type of request to be generated. See the individual bit descriptions for information on the types of requests the bits support. The user must not write to the DSPI \_RSER while the DSPI is running. x

## Deserial Serial Peripheral Interface (DSPI)

|          | 16          | 17          | 18          | 19          | 20          | 21          | 22          | 23          | 24          | 25          | 26          | 27          | 28          | 29          | 30          | 31          |
|----------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| R        | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| W        |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 | Base + 0x30 |

Figure 20-7. DSPI DMA/Interrupt Request Select and Enable Register (DSPI x \_RSER)

<!-- image -->

Table 20-7. DSPI x \_RSER Field Descriptions

| Bits   | Name      | Description                                                                                                                                                                                                                                                                                                                                                             |
|--------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0      | TCF_RE    | Transmission complete request enable. Enables TCF flag in the DSPI x _SR to generate an interrupt request. 0 TCF interrupt requests are disabled 1 TCF interrupt requests are enabled                                                                                                                                                                                   |
| 1-2    | -         | Reserved.                                                                                                                                                                                                                                                                                                                                                               |
| 3      | EOQF_RE   | DSPI finished request enable. Enables the EOQF flag in the DSPI x _SR to generate an interrupt request. 0 EOQF interrupt requests are disabled 1 EOQF interrupt requests are enabled                                                                                                                                                                                    |
| 4      | TFUF_RE   | Transmit FIFO underflow request enable.The TFUF_RE bit enables the TFUF flag in the DSPI x _SR to generate an interrupt request. 0 TFUF interrupt requests are disabled 1 TFUF interrupt requests are enabled                                                                                                                                                           |
| 5      | -         | Reserved.                                                                                                                                                                                                                                                                                                                                                               |
| 6      | TFFF_RE   | Transmit FIFO fill request enable. Enables the TFFF flag in the DSPI x _SR to generate a request. The TFFF_DIRS bit selects between generating an interrupt request or a DMA requests. 0 TFFF interrupt requests or DMA requests are disabled 1 TFFF interrupt requests or DMA requests are enabled                                                                     |
| 7      | TFFF_DIRS | Transmit FIFO fill DMA or interrupt request select. Selects between generating a DMA request or an interrupt request. When the TFFF flag bit in the DSPI x _SR is set, and the TFFF_RE bit in the DSPI x _RSER is set, this bit selects between generating an interrupt request or a DMA request. 0 Interrupt request will be generated 1 DMA request will be generated |
| 8-11   | -         | Reserved.                                                                                                                                                                                                                                                                                                                                                               |

## MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

Table 20-7. DSPI x \_RSER Field Descriptions

| Bits   | Name      | Description                                                                                                                                                                                                                                                                                                                                                                      |
|--------|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12     | RFOF_RE   | Receive FIFO overflow request enable. Enables the RFOF flag in the DSPI x _SR to generate an interrupt requests. 0 RFOF interrupt requests are disabled 1 RFOF interrupt requests are enabled                                                                                                                                                                                    |
| 13     | -         | Reserved.                                                                                                                                                                                                                                                                                                                                                                        |
| 14     | RFDF_RE   | Receive FIFO drain request enable. Enables the RFDF flag in the DSPI x _SR to generate a request. The RFDF_DIRS bit selects between generating an interrupt request or a DMA request. 0 RFDF interrupt requests or DMA requests are disabled 1 RFDF interrupt requests or DMA requests are enabled                                                                               |
| 15     | RFDF_DIRS | Receive FIFO drain DMA or interrupt request select. Selects between generating a DMA request or an interrupt request. When the RFDF flag bit in the DSPI x _SR is set, and the RFDF_RE bit in the DSPI x _RSER is set, the RFDF_DIRS bit selects between generating an interrupt request or a DMA request. 0 Interrupt request will be generated 1 DMA request will be generated |
| 16-31  | -         | Reserved.                                                                                                                                                                                                                                                                                                                                                                        |

## 20.3.2.6 DSPI PUSH TX FIFO Register (DSPI x \_PUSHR)

The DSPI \_PUSHR provides a means to write to the TX FIFO. Data written to this register is transferred x to the TX FIFO. See Section 20.4.3.4, 'Transmit First In First Out (TX FIFO) Buffering Mechanism,' for more information. Write accesses of 8- or 16-bits to the DSPI x \_PUSHR will transfer 32 bits to the TX FIFO.

## NOTE

Only the TXDATA field is used for DSPI slaves.

Figure 20-8. DSPI PUSH TX FIFO Register (DSPI x \_PUSHR)

<!-- image -->

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

## Table 20-8. DSPI x \_PUSHR Field Descriptions

| Bits   | Name       | Description                                                                                                                                                                                                                                                                                                                                                                                                                      | Description                                                                                                                                                                                                                                                                                                                                                                                                                      |
|--------|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0      | CONT       | Continuous peripheral chip select enable.Selects a continuous selection format. The bit is used in SPI master mode. The bit enables the selected PCS signals to remain asserted between transfers. See Section 20.4.7.5, 'Continuous Selection Format,' for more information. 0 Return peripheral chip select signals to their inactive state between transfers 1 Keep peripheral chip select signals asserted between transfers | Continuous peripheral chip select enable.Selects a continuous selection format. The bit is used in SPI master mode. The bit enables the selected PCS signals to remain asserted between transfers. See Section 20.4.7.5, 'Continuous Selection Format,' for more information. 0 Return peripheral chip select signals to their inactive state between transfers 1 Keep peripheral chip select signals asserted between transfers |
| 1-3    | CTAS [0:2] | Clock and transfer attributes select. Selects which of the DSPI x _CTARs is used to set the transfer attributes for the associated SPI frame. In SPI slave mode DSPI x _CTAR0 is used. The table below shows how the CTAS values map to the DSPI x _CTARs. There are eight DSPI x _CTARs in the MPC5553/MPC5554 DSPI implementation. Note: The field is only used in SPI master mode.                                            | Clock and transfer attributes select. Selects which of the DSPI x _CTARs is used to set the transfer attributes for the associated SPI frame. In SPI slave mode DSPI x _CTAR0 is used. The table below shows how the CTAS values map to the DSPI x _CTARs. There are eight DSPI x _CTARs in the MPC5553/MPC5554 DSPI implementation. Note: The field is only used in SPI master mode.                                            |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | CTAS                                                                                                                                                                                                                                                                                                                                                                                                                             |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 000                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 001                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 010                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 011                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 100                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 101                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 110                                                                                                                                                                                                                                                                                                                                                                                                                              |
|        |            |                                                                                                                                                                                                                                                                                                                                                                                                                                  | 111                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 4      | EOQ        | End of queue. Provides a means for host software to signal to the DSPI that the current SPI transfer is the last in a queue. At the end of the transfer the EOQF bit in the DSPI x _SR is set. 0 The SPI data is not the last data to transfer 1 The SPI data is the last data to transfer                                                                                                                                       | End of queue. Provides a means for host software to signal to the DSPI that the current SPI transfer is the last in a queue. At the end of the transfer the EOQF bit in the DSPI x _SR is set. 0 The SPI data is not the last data to transfer 1 The SPI data is the last data to transfer                                                                                                                                       |
| 5      | CTCNT      | Clear SPI_TCNT. Provides a means for host software to clear the SPI transfer counter. The CTCNT bit clears the SPI_TCNT field in the DSPI x _TCR. The SPI_TCNT field is cleared before transmission of the current SPI frame begins. 0 Do not clear SPI_TCNT field in the DSPI x _TCR 1 Clear SPI_TCNT field in the DSPI x _TCR Note: This bitfield is used only in SPI master mode                                              | Clear SPI_TCNT. Provides a means for host software to clear the SPI transfer counter. The CTCNT bit clears the SPI_TCNT field in the DSPI x _TCR. The SPI_TCNT field is cleared before transmission of the current SPI frame begins. 0 Do not clear SPI_TCNT field in the DSPI x _TCR 1 Clear SPI_TCNT field in the DSPI x _TCR Note: This bitfield is used only in SPI master mode                                              |
| 6-7    | -          | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                        | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 8-9    | -          | Reserved, but implemented. These bits are writable, but have no effect.                                                                                                                                                                                                                                                                                                                                                          | Reserved, but implemented. These bits are writable, but have no effect.                                                                                                                                                                                                                                                                                                                                                          |

Table 20-8. DSPI x \_PUSHR Field Descriptions

| Bits   | Name          | Description                                                                                                                                                                                     |
|--------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 10-15  | PCS n         | Peripheral chip select n . Selects which PCS signals will be asserted for the transfer. 0 Negate the PCS n signal 1 Assert the PCS n signal Note: This bitfield is only used in SPI master mode |
| 16-31  | TXDATA [0:15] | Transmit data. Holds SPI data to be transferred according to the associated SPI command. Note: TXDATA is used in slave mode.                                                                    |

## 20.3.2.7 DSPI POP RX FIFO Register (DSPI x \_POPR)

The DSPI \_POPR provides a means to read the RX FIFO. See Section 20.4.3.5, 'Receive First In First x Out (RX FIFO) Buffering Mechanism' for a description of the RX FIFO operations. Eight or sixteen bit read accesses to the DSPI x \_POPR will read from the RX FIFO and update the counter and pointer.

## NOTE

The DSPI \_POPR must not be read speculatively. For future compatibility, x the TLB entry covering the DSPI x \_POPR must be configured to be guarded.

Figure 20-9. DSPI POP RX FIFO Register (DSPI x \_POPR)

|          | 0           | 1           | 2           | 3           | 4           | 5           | 6           | 7           | 8           | 9           | 10          | 11          | 12          | 13          | 14          | 15          |
|----------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| R        | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| W        |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 |

|          | 16          | 17          | 18          | 19          | 20          | 21          | 22          | 23          | 24          | 25          | 26          | 27          | 28          | 29          | 30          | 31          |
|----------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| R        | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      | RXDATA      |
| W        |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 | Base + 0x38 |

Table 20-9. DSPI x \_POPR Field Descriptions

| Bits   | Name          | Description                                                                                                                       |
|--------|---------------|-----------------------------------------------------------------------------------------------------------------------------------|
| 0-15   | -             | Reserved, should be cleared.                                                                                                      |
| 16-31  | RXDATA [0:15] | Received data. The RXDATA field contains the SPI data from the RX FIFO entry pointed to by the pop next data pointer (POPNXTPTR). |

## MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

## 20.3.2.8 DSPI Transmit FIFO Registers 0-3 (DSPI x \_TXFR ) n

The DSPI \_TXFR  registers provide visibility into the TX FIFO for debugging purposes. Each register is x n an entry in the TX FIFO. The registers are read-only and cannot be modified. Reading the DSPI x \_TXFR n registers  does  not  alter  the  state  of  the  TX  FIFO.  The  MPC5553/MPC5554  uses  four  registers  to implement the TX FIFO, that is DSPI x \_TXFR0-DSPI \_TXFR3 are used. x

Figure 20-10. DSPI Transmit FIFO Register 0-3 (DSPI x \_TXFR ) n

<!-- image -->

Table 20-10. DSPI x \_TXFR  Field Descriptions n

| Bits   | Name          | Description                                                                                                                                                                                    |
|--------|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0-15   | TXCMD [0:15]  | Transmit command. Contains the command that sets the transfer attributes for the SPI data. See Section 20.3.2.6, 'DSPI PUSH TX FIFO Register (DSPIx_PUSHR),' for details on the command field. |
| 16-31  | TXDATA [0:15] | Transmit data. Contains the SPI data to be shifted out.                                                                                                                                        |

## 20.3.2.9 DSPI Receive FIFO Registers 0-3 (DSPI x \_RXFR ) n

The DSPI \_RXFR  registers provide visibility into the RX FIFO for debugging purposes. Each register is x n an entry in the RX FIFO. The DSPI x \_RXFR registers are read-only. Reading the DSPI x \_RXFR  registers n does not alter the state of the RX FIFO. The MPC5553/MPC5554 uses four registers to implement the RX FIFO, that is DSPI x \_RXFR0-DSPI \_RXFR3 are used. x

Figure 20-11. DSPI Receive FIFO Registers 0-3 (DSPI x \_RXFR ) n

<!-- image -->

Table 20-11. DSPI x \_RXFR  Field Description n

| Bits   | Name          | Description                                   |
|--------|---------------|-----------------------------------------------|
| 0-15   | -             | Reserved, should be cleared.                  |
| 16-31  | RXDATA [15:0] | Receive data. Contains the received SPI data. |

## 20.3.2.10 DSPI DSI Configuration Register (DSPI x \_DSICR)

The DSPI \_DSICR selects various attributes associated with DSI and CSI configurations. The user must x not write to the DSPI x \_DSICR while the DSPI is running.

Figure 20-12. DSPI DSI Configuration Register (DSPI x \_DSICR)

<!-- image -->

## Table 20-12. DSPI x \_DSICR Field Descriptions

| Bits   | Name         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|--------|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0      | MTOE         | Multiple transfer operation enable. Enables multiple DSPIs to be connected in a parallel or serial configuration. See Section 20.4.4.7, 'Multiple Transfer Operation (MTO),' for more information. 0 Multiple transfer operation disabled 1 Multiple transfer operation enabled                                                                                                                                                                                                                                                                                                                              |
| 1      | -            | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 2-7    | MTOCNT [0:5] | Multiple transfer operation count. Selects number of bits to be shifted out during a transfer in multiple transfer operation. The field sets the number of SCK cycles that the bus master will generate to complete the transfer. The number of SCK cycles used will be one more than the value in the MTOCNT field. The number of SCK cycles defined by MTOCNT must be equal to or greater than the frame size.                                                                                                                                                                                             |
| 8-11   | -            | Reserved.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 12     | TXSS         | Transmit data source select. Selects the source of data to be serialized. The source can be either data from host software written to the DSPI DSI alternate serialization data register (DSPI x _ASDR), or parallel output pin states latched into the DSPI DSI serialization data register (DSPI x _SDR). 0 Source of serialized data is the DSPI x _SDR 1 Source of serialized data is the DSPI x _ASDR                                                                                                                                                                                                   |
| 13     | TPOL         | Trigger polarity. Selects the active edge of the internal hardware trigger input signal ( ht ). The bit selects which edge will initiate a transfer in the DSI configuration. See Section 20.4.4.5, 'DSI Transfer Initiation Control,' for more information. 0 Falling edge will initiate a transfer 1 Rising edge will initiate a transfer                                                                                                                                                                                                                                                                  |
| 14     | TRRE         | Trigger reception enable. Enables the DSPI to initiate a transfer when an external trigger signal is received. The bit is only valid in DSI configuration. See Section 20.4.4.5, 'DSI Transfer Initiation Control,' for more information. 0 Trigger signal reception disabled 1 Trigger signal reception enabled                                                                                                                                                                                                                                                                                             |
| 15     | CID          | Change in data transfer enable. Enables a change in serialization data to initiate a transfer. The bit is used in master mode in DSI and CSI configurations to control when to initiate transfers. When the CID bit is set, serialization is initiated when the current DSI data differs from the previous DSI data shifted out. The DSPI x _COMPR is compared with the DSPI x _SDR or DSPI x _ASDR to detect a change in data. Refer to Section 20.4.4.5, 'DSI Transfer Initiation Control,' for more information. 0 Change in data transfer operation disabled 1 Change in data transfer operation enabled |
| 16     | DCONT        | DSI continuous peripheral chip select enable. Enables the PCS signals to remain asserted between transfers. The DCONT bit only affects the PCS signals in DSI master mode. See Section 20.4.7.5, 'Continuous Selection Format,' for details. 0 Return peripheral chip select signals to their inactive state after transfer is complete 1 Keep peripheral chip select signals asserted after transfer is complete                                                                                                                                                                                            |

## Table 20-12. DSPI x \_DSICR Field Descriptions (continued)

| Bits   | Name          | Description                                                                                                                                                                                                                                                                                                                               |
|--------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 17-19  | DSICTAS [0:2] | DSI clock and transfer attributes select. The DSICTAS field selects which of the DSPI x _CTARs is used to provide transfer attributes in DSI configuration. The DSICTAS field is used in DSI master mode. In DSI slave mode, the DSPI x _CTAR1 is always selected. The table below shows how the DSICTAS values map to the DSPI x _CTARs. |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 17-19  | DSICTAS [0:2] |                                                                                                                                                                                                                                                                                                                                           |
| 20-23  | -             | Reserved.                                                                                                                                                                                                                                                                                                                                 |
| 24-25  | -             | Reserved, but implemented. These bits are writable, but have no effect.                                                                                                                                                                                                                                                                   |
| 26-31  | DPCS n        | DSI peripheral chip select n . The DPCS bits select which of the PCS signals to assert during a DSI transfer. The DPCS bits only control the assertions of the PCS signals in DSI master mode. 0 Negate PCS n                                                                                                                             |

## 20.3.2.11 DSPI DSI Serialization Data Register (DSPI x \_SDR)

The DSPI \_SDR contains the signal states of the parallel input signals from the eTPU or the eMIOS. The x pin states of the parallel input signals are latched into the DSPI x \_SDR on the rising edge of every system clock. The DSPI x \_SDR is read-only. When the TXSS bit in the DSPI x \_DSICR is negated, the data in the DSPI \_SDR is the source of the serialized data. x

Figure 20-13. DSPI DSI Serialization Data Register (DSPI x \_SDR)

|          | 0               | 1               | 2               | 3               | 4               | 5               | 6               | 7               | 8               | 9               | 10              | 11              | 12              | 13              | 14              | 15              |
|----------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
| R        | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               |
| W        |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |
| Reset    | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               |
| Reg Addr | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     |
|          | 16              | 17              | 18              | 19              | 20              | 21              | 22              | 23              | 24              | 25              | 26              | 27              | 28              | 29              | 30              | 31              |
| R        | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] | SER_DATA [15:0] |
| W        |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |                 |
| Reset    | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               | 0               |
| Reg Addr | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     | Base + 0xC0     |

Table 20-13. DSPI x \_SDR Field Description

| Bits   | Name            | Description                                                                                                                                                                                                                               |
|--------|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0-15   | -               | Reserved.                                                                                                                                                                                                                                 |
| 16-31  | SER_DATA [15:0] | Serialized data. The SER_DATA field contains the signal states of the parallel input signals. SER_DATA [15:0] maps to DSPI serialization inputs IN[15:0]. Refer to Section 20.4.4.6, 'DSPI Connections to eTPU_A, eTPU_B, EMIOS and SIU.' |

## 20.3.2.12 DSPI DSI Alternate Serialization Data Register (DSPI x \_ASDR)

The DSPI \_ASDR provides a means for host software to write the data to be serialized. When the TXSS x bit in the DSPI x \_DSICR is set, the data in the DSPI x \_ASDR is the source of the serialized data. Writes to the DSPI \_ASDR take effect on the next frame boundary. x

Figure 20-14. DSPI DSI Alternate Serialization Data Register (DSPI x \_ASDR)

<!-- image -->

Table 20-14. DSPI x \_ASDR Field Description

| Bits   | Name             | Description                                                                               |
|--------|------------------|-------------------------------------------------------------------------------------------|
| 0-15   | -                | Reserved.                                                                                 |
| 16-31  | ASER_DATA [0:15] | Alternate serialized data. The ASER_DATA field holds the alternate data to be serialized. |

## 20.3.2.13 DSPI DSI Transmit Comparison Register (DSPI x \_COMPR)

The DSPI \_COMPR holds a copy of the last transmitted DSI data. The DSPI x x \_COMPR is read-only. DSI data is transferred to this register as it is loaded into the TX shift register.

|          | 0           | 1           | 2           | 3           | 4           | 5           | 6           | 7           | 8           | 9           | 10          | 11          | 12          | 13          | 14          | 15          |
|----------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| R        | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| W        |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 |

|          | 16          | 17          | 18          | 19          | 20          | 21          | 22          | 23          | 24          | 25          | 26          | 27          | 28          | 29          | 30          | 31          |
|----------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| R        | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   | COMP_DATA   |
| W        |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |             |
| Reset    | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           | 0           |
| Reg Addr | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 | Base + 0xC8 |

Figure 20-15. DSPI DSI Transmit Comparison Register (DSPI x \_COMPR)

<!-- image -->

Table 20-15. DSPI x \_COMPR Field Description

| Bits   | Name             | Description                                                           |
|--------|------------------|-----------------------------------------------------------------------|
| 0-15   | -                | Reserved.                                                             |
| 16-31  | COMP_DATA [0:15] | Compare data. The COMP_DATA field holds the last serialized DSI data. |

## 20.3.2.14 DSPI DSI Deserialization Data Register (DSPI x \_DDR)

The DSPI \_DDR holds the signal states for the parallel output signals. The DSPI x x \_DDR is read-only and it is memory mapped so that host software can read the incoming DSI frames.

Figure 20-16. DSPI Deserialization Data Register (DSPI x \_DDR)

<!-- image -->

Table 20-16. DSPI x \_DDR Field Description

| Bits   | Name       | Description                                                                                                    |
|--------|------------|----------------------------------------------------------------------------------------------------------------|
| 0-15   | -          | Reserved.                                                                                                      |
| 16-31  | DESER_DATA | Deserialized data. Holds deserialized data which is presented as signal states to the parallel output signals. |

## 20.4 Functional Description

The DSPI supports full-duplex, synchronous serial communications between the MPC5553/MPC5554 and peripheral devices. The DSPI can also be used to reduce the number of pins required for I/O by serializing and deserializing up to 16 parallel input/output signals from the eTPU and eMIOS. All communications are through an SPI-like protocol.

The DSPI has three configurations:

- · SPI configuration in which the DSPI operates as a basic SPI or a queued SPI.
- · DSI configuration in which the DSPI serializes and deserializes parallel input/output signals or bits from memory mapped registers.
- · CSI configuration in which the DSPI combines the functionality of the SPI and DSI configurations.

The DCONF field in the DSPI \_MCR register determines the DSPI configuration. See Table 20-3 for the x DSPI configuration values.

The DSPI \_CTAR0-DSPI \_CTAR7 registers hold clock and transfer attributes. The manner in which a x x CTAR is selected depends on the DSPI configuration (SPI, DSI, or CSI). The SPI configuration can select which CTAR to use on a frame by frame basis by setting the CTAS field in the DSPI x \_PUSHR. The DSI configuration statically selects which CTAR to use. In CSI configuration, priority logic determines if SPI data or DSI data is transferred. The type of data transferred (whether DSI or SPI) dictates which CTAR the CSI configuration will  use.  See  Section 20.3.2.3,  'DSPI  Clock  and  Transfer  Attributes  Registers  0-7 (DSPIx\_CTARn),' for information on DSPI \_CTAR fields. x

The 16-bit shift register in the master and the 16-bit shift register in the slave are linked by the SOUT and SIN signals to form a distributed 32-bit register. When a data transfer operation is performed, data is

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

serially  shifted  a  pre-determined  number  of  bit  positions.  Because  the  registers  are  linked,  data  is exchanged between the master and the slave; the data that was in the master's shift register is now in the shift register of the slave, and vice versa. At the end of a transfer, the TCF bit in the DSPI x \_SR is set to indicate a completed transfer. Figure 20-17 illustrates how master and slave data is exchanged.

Figure 20-17. SPI and DSI Serial Protocol Overview

<!-- image -->

The DSPI has six peripheral chip select (PCS) signals that are be used to select which of the slaves to communicate with.

Transfer protocols and timing properties are shared by the three DSPI configurations; these properties are described independently of the configuration in Section 20.4.7, 'Transfer Formats.' The transfer rate and delay settings are described in section Section 20.4.6, 'DSPI Baud Rate and Clock Delay Generation.'

See Section 20.4.10, 'Power Saving Features' for information on the power-saving features of the DSPI.

## 20.4.1 Modes of Operation

The MPC5553/MPC5554 DSPIs have four available distinct modes:

- · Master mode
- · Slave mode
- · Module disable mode
- · Debug mode

Master, slave, and  module  disable  modes  are  module-specific  modes  while  debug  mode  is  a MPC5553/MPC5554-specific mode.

The module-specific modes are determined by bits in the DSPI x \_MCR. Debug mode is a mode that the entire  MPC5553/MPC5554  can  enter  in  parallel  with  the  DSPI  being  configured  in  one  of  its module-specific modes.

## 20.4.1.1 Master Mode

In master mode the DSPI can initiate communications with peripheral devices. The DSPI operates as bus master  when  the  MSTR  bit  in  the  DSPI x \_MCR  is  set.  The  serial  communications  clock  (SCK)  is controlled by the master DSPI. All three DSPI configurations are valid in master mode.

In SPI configuration, master mode transfer attributes are controlled by the SPI command in the current TX FIFO entry. The CTAS field in the SPI command selects which of the eight DSPI x \_CTARs will be used to set  the  transfer  attributes.  Transfer  attribute  control  is  on  a  frame  by  frame  basis.  See  Section 20.4.3, 'Serial Peripheral Interface (SPI) Configuration' for more details.

In DSI configuration, master mode transfer attributes are controlled by the DSPI x \_DSCIR. A detailed description  of  the  DSPI x \_DSCIR  is  located  in  Section 20.3.2.10,  'DSPI  DSI  Configuration  Register

(DSPIx\_DSICR).' The DSISCTAS field in the DSPI \_DSICR selects which of the DSPI x x \_CTARs will be used  to  set  the  transfer  attributes.  Transfer  attributes  are  set  up  during  initialization  and  must  not  be changed between frames. See Section 20.4.4, 'Deserial Serial Interface (DSI) Configuration,' for more details.

The CSI configuration is only available in master mode. In CSI configuration, the DSI data is transferred using DSI configuration transfer attributes and SPI data is transferred using the SPI configuration transfer attributes. In order for the bus slave to distinguish between DSI and SPI frames, the transfer attributes for the two types of frames must utilize different peripheral chip select signals. See Section 20.4.5, 'Combined Serial Interface (CSI) Configuration,' for details.

## 20.4.1.2 Slave Mode

In slave mode the DSPI responds to transfers initiated by an SPI master. The DSPI operates as bus slave when the MSTR bit in the DSPI \_MCR is negated. The DSPI slave is selected by a bus master by having x the slave's SS asserted. In slave mode the SCK is provided by the bus master. All transfer attributes are controlled by the bus master but clock polarity, clock phase and numbers of bits to transfer must still be configured in the DSPI slave for proper communications.

The SPI and DSI configurations are valid in slave mode. CSI configuration is not available in slave mode. In SPI slave mode the slave transfer attributes are set in the DSPI x \_CTAR0. In DSI slave mode the slave transfer attributes are set in the DSPI x \_CTAR1. In slave mode, for both SPI and DSI configurations, data is transferred MSB first. The LSBFE field of the associated CTAR is ignored.

## 20.4.1.3 Module Disable Mode

The module disable mode is used for MCU power management. The clock to the non-memory mapped logic in the DSPI is stopped while in module disable mode. The DSPI enters the module disable mode when the MDIS bit in DSPI x \_MCR is set. See Section 20.4.10, 'Power Saving Features,' for more details on the module disable mode.

## 20.4.1.4 Debug Mode

The debug mode is used for system development and debugging. If the MPC5553/MPC5554 enters debug mode while the FRZ bit in the DSPI x \_MCR is set, the DSPI stops all serial transfers and enters a stopped state. If the MPC5553/MPC5554 enters debug mode while the FRZ bit is negated, the DSPI behavior is unaffected and remains dictated by the module-specific mode and configuration of the DSPI. The DSPI enters debug mode when a debug request is asserted by an external controller. See Figure 20-18 for a state diagram.

## 20.4.2 Start and Stop of DSPI Transfers

The  DSPI  has  two  operating  states;  STOPPED  and  RUNNING.  The  states  are  independent  of  DSPI configuration. The default state of the DSPI is STOPPED. In the STOPPED state no serial transfers are initiated in master mode and no transfers are responded to in slave mode. The STOPPED state is also a safe state for writing the various configuration registers of the DSPI without causing undetermined results. The TXRXS bit in the DSPI \_SR is negated in this state. In the RUNNING state, serial transfers take x place. The TXRXS bit in the DSPI \_SR is asserted in the RUNNING state. Figure 20-18 shows a state x diagram of the start and stop mechanism. The transitions are described in Table 20-17.

Figure 20-18. DSPI Start and Stop State Diagram

<!-- image -->

Table 20-17. State Transitions for Start and Stop of DSPI Transfers

|   Transition # | Current State   | Next State   | Description                                                                                                                                                                                                                       |
|----------------|-----------------|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|              0 | RESET           | STOPPED      | Generic power-on-reset transition                                                                                                                                                                                                 |
|              1 | STOPPED         | RUNNING      | The DSPI is started (DSPI transitions to RUNNING) when all of the following conditions are true: GLYPH<127> EOQF bit is clear GLYPH<127> Debug mode is unselected or the FRZ bit is clear GLYPH<127> HALT bit is clear            |
|              2 | RUNNING         | STOPPED      | The DSPI stops (transitions from RUNNINGtoSTOPPED)after the current frame for any one of the following conditions: GLYPH<127> EOQF bit is set GLYPH<127> Debug mode is selected and the FRZ bit is set GLYPH<127> HALT bit is set |

State  transitions  from  RUNNING  to  STOPPED  occur  on  the  next  frame  boundary  if  a  transfer  is  in progress, or on the next system clock cycle if no transfers are in progress.

## 20.4.3 Serial Peripheral Interface (SPI) Configuration

The SPI configuration transfers data serially using a shift register and a selection of programmable transfer attributes. The DSPI is in SPI configuration when the DCONF field in the DSPI x \_MCR is 0b00. The SPI frames can be from 4 to 16 bits long. The data to be transmitted can come from queues stored in RAM external to the DSPI. Host software or an eDMA controller can transfer the SPI data from the queues to a first-in first-out (FIFO) buffer. The received data is stored in entries in the receive FIFO (RX FIFO) buffer. Host software or an eDMA controller transfers the received data from the RX FIFO to memory external to the DSPI. The FIFO buffer operations are described in Section 20.4.3.4, 'Transmit First In First Out (TX FIFO) Buffering Mechanism,' and Section 20.4.3.5, 'Receive First In First Out (RX FIFO) Buffering Mechanism.' The interrupt and DMA request conditions are described in Section 20.4.9, 'Interrupts/DMA Requests.'

The SPI configuration supports two module-specific modes; master mode and slave mode. The FIFO operations are similar for the master mode and slave mode. The main difference is that in master mode the DSPI initiates and controls the transfer according to the fields in the SPI command field of the TX FIFO entry. In slave mode the DSPI only responds to transfers initiated by a bus master external to the DSPI and the SPI command field of the TX FIFO entry is ignored.

## 20.4.3.1 SPI Master Mode

In SPI master mode the DSPI initiates the serial transfers by controlling the serial communications clock (SCK) and the peripheral chip select (PCS) signals. The SPI command field in the executing TX FIFO entry determines which CTARs will be used to set the transfer attributes and which PCS signal to assert. The command field also contains various bits that help with queue management and transfer protocol. See Section 20.3.2.6, 'DSPI PUSH TX FIFO Register (DSPIx\_PUSHR),' for details on the SPI command fields. The data field in the executing TX FIFO entry is loaded into the shift register and shifted out on the serial out (SOUT) pin. In SPI master mode, each SPI frame to be transmitted has a command associated with it allowing for transfer attribute control on a frame by frame basis.

## 20.4.3.2 SPI Slave Mode

In SPI slave mode the DSPI responds to transfers initiated by an SPI bus master. The DSPI does not initiate transfers. Certain transfer attributes such as clock polarity, clock phase and frame size must be set for successful  communication  with  an  SPI  master.  The  SPI  slave  mode  transfer  attributes  are  set  in  the DSPI \_CTAR0. x

## 20.4.3.3 FIFO Disable Operation

The FIFO disable mechanisms allow SPI transfers without using the TX FIFO or RX FIFO. The DSPI operates as a double-buffered simplified SPI when the FIFOs are disabled. The TX and RX FIFOs are disabled separately. The TX FIFO is disabled by writing a 1 to the DIS\_TXF bit in the DSPI x \_MCR. The RX FIFO is disabled by writing a 1 to the DIS\_RXF bit in the DSPI x \_MCR.

The  FIFO  disable  mechanisms  are  transparent  to  the  user  and  to  host  software;  transmit  data  and commands are written to the DSPI x \_PUSHR and received data is read from the DSPI x \_POPR. When the TX FIFO is disabled, the TFFF, TFUF, and TXCTR fields in DSPI x \_SR behave as if there is a one-entry FIFO but the  contents  of  the  DSPI x \_TXFRs and TXNXTPTR are undefined. When the RX FIFO is disabled, the RFDF, RFOF, and RXCTR fields in the DSPI x \_SR behave as if there is a one-entry FIFO but the contents of the DSPI x \_RXFRs and POPNXTPTR are undefined.

The TX and RX FIFOs should be disabled only if the application's operating mode requires the FIFO to be disabled. A FIFO must be disabled before it is accessed. Failure to disable a FIFO prior to a first FIFO access is not supported, and may result in incorrect results.

## 20.4.3.4 Transmit First In First Out (TX FIFO) Buffering Mechanism

The TX FIFO functions as a buffer of SPI data and SPI commands for transmission. The TX FIFO holds four entries, each consisting of a command field and a data field. SPI commands and data are added to the TX FIFO by writing to the DSPI push TX FIFO register (DSPI \_PUSHR). For more information on x DSPI \_PUSHR, refer to Section 20.3.2.6, 'DSPI PUSH TX FIFO Register (DSPIx\_PUSHR).' TX FIFO x entries can only be removed from the TX FIFO by being shifted out or by flushing the TX FIFO.

The TX FIFO counter field (TXCTR) in the DSPI status register (DSPI x \_SR) indicates the number of valid entries in the TX FIFO. The TXCTR is updated every time the DSPI \_PUSHR is written or SPI data is transferred  into  the  shift  register  from  the  TX  FIFO.  For  more  information  on  DSPI x \_SR,  refer  to Section 20.3.2.4, 'DSPI Status Register (DSPIx\_SR).'

The TXNXTPTR field indicates which TX FIFO entry will be transmitted during the next transfer. The TXNXTPTR contains the positive offset from DSPI x \_TXFR0 in number of 32-bit registers. For example, TXNXTPTR equal to two means that the DSPI \_TXFR2 contains the SPI data and command for the next x

transfer. The TXNXTPTR field is incremented every time SPI data is transferred from the TX FIFO to the shift register.

## 20.4.3.4.1 Filling the TX FIFO

Host  software  or  the  eDMA  controller  can  add  (push)  entries  to  the  TX  FIFO  by  writing  to  the DSPI \_PUSHR. When the TX FIFO is not full, the TX FIFO fill flag (TFFF) in the DSPI x x \_SR is set. The TFFF  bit  is  cleared  when  the  TX  FIFO  is  full  and  the  eDMA  controller  indicates  that  a  write  to DSPI \_PUSHR is complete or alternatively by host software writing a 1 to the TFFF in the DSPI x x \_SR. The TFFF can generate a DMA request or an interrupt request. See Section 20.4.9.2, 'Transmit FIFO Fill Interrupt or DMA Request (TFFF),' for details.

The DSPI ignores attempts to push data to a full TX FIFO; that is, the state of the TX FIFO is unchanged. No error condition is indicated.

## 20.4.3.4.2 Draining the TX FIFO

The TX FIFO entries are removed (drained) by shifting SPI data out through the shift register. Entries are transferred from the TX FIFO to the shift register and shifted out as long as there are valid entries in the TX FIFO. Every time an entry is transferred from the TX FIFO to the shift register, the TX FIFO counter is  decremented  by  one.  At  the  end  of  a  transfer,  the  TCF  bit  in  the  DSPI x \_SR is  set  to  indicate  the completion of a transfer. The TX FIFO is flushed by writing a 1 to the CLR\_TXF bit in DSPI x \_MCR.

If an external SPI bus master initiates a transfer with a DSPI slave while the slave's DSPI TX FIFO is empty, the transmit FIFO underflow flag (TFUF) in the slave's DSPI x \_SR is set. See Section 20.4.9.4, 'Transmit FIFO Underflow Interrupt Request (TFUF),'for details.

## 20.4.3.5 Receive First In First Out (RX FIFO) Buffering Mechanism

The RX FIFO functions as a buffer for data received on the SIN pin. The RX FIFO holds four received SPI data frames. SPI data is added to the RX FIFO at the completion of a transfer when the received data in the shift register is transferred into the RX FIFO. SPI data is removed (popped) from the RX FIFO by reading the DSPI x \_POPR register. RX FIFO entries can only be removed from the RX FIFO by reading the  DSPI x \_POPR or by flushing  the  RX  FIFO.  For  more  information  on  the  DSPI x \_POPR, refer  to Section 20.3.2.7, 'DSPI POP RX FIFO Register (DSPIx\_POPR).'

The RX FIFO counter field (RXCTR) in the DSPI status register (DSPI x \_SR) indicates the number of valid entries in the RX FIFO. The RXCTR is updated every time the DSPI \_POPR is read or SPI data is copied from the shift register to the RX FIFO.

The  POPNXTPTR  field  in  the  DSPI x \_SR  points  to  the  RX  FIFO  entry  that  is  returned  when  the DSPI \_POPR is read. The POPNXTPTR contains the positive, 32-bit word offset from DSPI x x \_RXFR0. For example, POPNXTPTR equal to two means that the DSPI \_RXFR2 contains the received SPI data x that will be returned when DSPI x \_POPR is read. The POPNXTPTR field is incremented every time the DSPI \_POPR is read. POPNXTPTR rolls over every four frames on the MPC5553/MPC5554. x

## 20.4.3.5.1 Filling the RX FIFO

The RX FIFO is filled with the received SPI data from the shift register. While the RX FIFO is not full, SPI frames from the shift register are transferred to the RX FIFO. Every time an SPI frame is transferred to the RX FIFO the RX FIFO counter is incremented by one.

If the RX FIFO and shift register are full and a transfer is initiated, the RFOF bit in the DSPI x \_SR is asserted indicating an overflow condition. Depending on the state of the ROOE bit in the DSPI x \_MCR, the data from the transfer that generated the overflow is either ignored or shifted in to the shift register. If

the ROOE bit is asserted, the incoming data is shifted in to the shift register. If the ROOE bit is negated, the incoming data is ignored.

## 20.4.3.5.2 Draining the RX FIFO

Host software or the eDMA can remove (pop) entries from the RX FIFO by reading the DSPI x \_POPR. For more  information on DSPI \_POPR,  refer  to  Section 20.3.2.7, x 'DSPI  POP  RX  FIFO  Register (DSPIx\_POPR).' A read of the DSPI \_POPR decrements the RX FIFO counter by one. Attempts to pop x data from an empty RX FIFO are ignored, the RX FIFO counter remains unchanged. The data returned from reading an empty RX FIFO is undetermined.

When the RX FIFO is not empty, the RX FIFO drain flag (RFDF) in the DSPI x \_SR is set. The RFDF bit is cleared when the RX\_FIFO is empty and the eDMA controller indicates that a read from DSPI x \_POPR is complete; alternatively the RFDF bit can be cleared by the host writing a 1 to it.

## 20.4.4 Deserial Serial Interface (DSI) Configuration

The DSI configuration supports pin count reduction by serializing parallel input signals or register bits and shifting them out in an SPI-like protocol. The timing and transfer protocol is described in Section 20.4.7, 'Transfer Formats.' The received serial frames are converted to a parallel form (deserialized) and placed on the parallel output signals or in a register. The various features of the DSI configuration are set in the DSPI \_DSICR.  For  more  information  on  the  DSPI x x \_DSICR,  refer  to  Section 20.3.2.10,  'DSPI  DSI Configuration Register (DSPIx\_DSICR).' The DSPI is in DSI configuration when the DCONF field in the DSPI \_MCR is 0b01. x

The DSI frames can be from 4 to 16 bits long. With multiple transfer operation (MTO), the DSPI supports serial  chaining  of  DSPI  modules  within  the  MPC5553/MPC5554  to  create  DSI  frames  consisting  of concatenated bits from multiple DSPIs. The DSPI also supports parallel chaining allowing several DSPIs and off-chip SPI devices to share the same serial communications clock (SCK) and peripheral chip select (PCS) signals. See Section 20.4.4.7, 'Multiple Transfer Operation (MTO),' for details on the serial and parallel chaining support.

## 20.4.4.1 DSI Master Mode

In DSI master mode the DSPI initiates and controls the DSI transfers. The DSI master has four different conditions that can initiate a transfer:

- · Continuous
- · Change in data
- · Trigger signal
- · Trigger signal combined with a change in data

The four transfer initiation conditions are described in Section 20.4.4.5, 'DSI Transfer Initiation Control.' Transfer  attributes  are  set  during  initialization.  The  DSICTAS  field  in  the  DSPI x \_DSICR determines which of the DSPI x \_CTARs will control the transfer attributes.

## 20.4.4.2 DSI Slave Mode

In DSI slave mode the DSPI responds to transfers initiated by an SPI or DSI bus master. In this mode the DSPI does not initiate DSI transfers. Certain transfer attributes such as clock polarity and phase must be set for successful communication with a DSI master. The DSI slave mode transfer attributes are set in the DSPI \_CTAR1. x

If the CID bit in the DSPI x \_DSICR is set and the data in the DSPI x \_COMPR differs from the selected source of the serialized data, the slave DSPI will assert the MTRIG signal. If the slave's internal hardware trigger signal is asserted and the TRRE is set, the slave DSPI asserts MTRIG. These features are included to  support  chaining  of  several  DSPI.  Details  about  the  MTRIG  signal  are  found  in  Section 20.4.4.7, 'Multiple Transfer Operation (MTO).'

## 20.4.4.3 DSI Serialization

In the DSI configuration, 4 to 16 bits can be serialized using two different sources. The TXSS bit in the DSPI \_DSICR selects between the DSPI \_SDR and DSPI \_ASDR as the source of serialized data. See x x x Section 20.3.2.11, 'DSPI DSI Serialization Data Register (DSPIx\_SDR),' and Section 20.3.2.12, 'DSPI DSI Alternate Serialization Data Register (DSPIx\_ASDR),' for more details. The DSPI x \_SDR holds the latest  parallel  input  signal  values  which  is  sampled  at  every  rising  edge  of  the  system  clock.  The DSPI \_ASDR is written by host software and used as an alternate source of serialized data. x

A copy of the last DSI frame shifted out of the shift register is stored in the DSPI x \_COMPR. This register provides  added  visibility  for  debugging  and  it  serves  as  a  reference  for  transfer  initiation  control. Figure 20-19  shows  the  DSI  serialization  logic.  Section 20.3.2.13,  'DSPI  DSI  Transmit  Comparison Register (DSPIx\_COMPR),' contains details on the DSPI x \_COMPR.

Figure 20-19. DSI Serialization Diagram

<!-- image -->

## 20.4.4.4 DSI Deserialization

When all bits in a DSI frame have been shifted in, the frame is copied to the DSPI x \_DDR. This register presents the deserialized data as parallel output signal values. The DSPI x \_DDR is memory mapped to allow host software to read the deserialized data directly. Figure 20-20 shows the DSI deserialization logic. for more information on the DSPI \_DDR, refer to Section 20.3.2.14, 'DSPI DSI Deserialization Data x Register (DSPIx\_DDR).'

Figure 20-20. DSI Deserialization Diagram

<!-- image -->

## 20.4.4.5 DSI Transfer Initiation Control

Data transfers for a master DSPI in DSI configuration are initiated by a condition. When chaining DSPIs, the master and all slaves must be configured for the transfer initiation. The transfer initiation conditions are selected by the TRRE and CID bits in the DSPI x \_DSICR. Table 20-18 lists the four transfer initiation conditions.

Table 20-18. DSI Data Transfer Initiation Control

| DSPI x _DSICR Bits   | DSPI x _DSICR Bits   |                                     |
|----------------------|----------------------|-------------------------------------|
| TRRE                 | CID                  | Type of Transfer Initiation Control |
| 0                    | 0                    | Continuous                          |
| 0                    | 1                    | Change in Data                      |
| 1                    | 0                    | Triggered                           |
| 1                    | 1                    | Triggered or Change in Data         |

## 20.4.4.5.1 Continuous Control

For continuous control, the initiation of a transfer is based on the baud rate at which data is transferred between the DSPI and the external device. The baud rate is set in  the  DSPI x \_CTAR selected by the DSICTAS field in the DSPI \_DSICR. A new DSI frame shifts out when the previous transfer cycle has x completed and the delay after transfer (t DT ) has elapsed.

## 20.4.4.5.2 Change In Data Control

For change in data control, a transfer is initiated when the data to be serialized has changed since the transfer  of  the  last  DSI  frame.  A  copy  of  the  previously  transferred  DSI  data  is  stored  in  the DSPI \_COMPR. When the data in the DSPI \_SDR or the DSPI \_ASDR is different from the data in the x x x DSPI \_COMPR, a new DSI frame is transmitted. The TXSS bit in the DSPI \_DSICR selects which x x register the DSPI x \_COMPR is compared to. The MTRIG output signal is asserted every time a change in data is detected.

## 20.4.4.5.3 Triggered Control

For triggered control, initiation of a transfer is controlled by the internal hardware trigger signal ( ht ). The TPOL bit in the DSPI x \_DSICR selects the active edge of ht . For ht to have any affect, the TRRE bit in the DSPI \_DSICR must be set. x

## 20.4.4.5.4 Triggered or Change In Data Control

For triggered or change in data control, initiation of a transfer is controlled by the ht signal or by the detection of a change in data to be serialized.

## 20.4.4.6 DSPI Connections to eTPU\_A, eTPU\_B, EMIOS and SIU

The four (MPC5554) or three (MPC5553) DSPI blocks connect to the input and output channels of the eTPUs and the EMIOS. The MPC5554 connects to eTPU\_A, eTPU\_B, EMIOS, and SIU. The MPC5553 connects to eTPU\_A, EMIOS, and SIU. Some of the DSPI outputs connect to the external interrupt input multiplexing subblock in the SIU. See Section 6.4.3, 'External Interrupt,' and Section 6.3.1.17, 'DSPI Input Select Register (SIU\_DISR),' for details on how the DSPI deserialized outputs can be used to trigger external interrupt requests.

## 20.4.4.6.1 DSPI\_A Connectivity (MPC5554 Only)

The DSPI\_A connects to the eTPU\_B as shown in Figure 20-21. The DSPI\_A is provided only in the MPC5554.

Figure 20-21. DSPI\_A Connectivity

<!-- image -->

Table 20-19 lists the DSPI\_A connections.

Table 20-19. DSPI\_A Connectivity Table

|   DSPI_A IN[ n ] | Connected to:            |
|------------------|--------------------------|
|                0 | eTPU_B Output Channel 15 |
|                1 | eTPU_B Output Channel 14 |
|                2 | eTPU_B Output Channel 13 |
|                3 | eTPU_B Output Channel 12 |
|                4 | eTPU_B Output Channel 11 |
|                5 | eTPU_B Output Channel 10 |
|                6 | eTPU_B Output Channel 9  |
|                7 | eTPU_B Output Channel 8  |
|                8 | eTPU_B Output Channel 7  |
|                9 | eTPU_B Output Channel 6  |
|               10 | eTPU_B Output Channel 5  |
|               11 | eTPU_B Output Channel 4  |
|               12 | eTPU_B Output Channel 3  |
|               13 | eTPU_B Output Channel 2  |

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

|   DSPI_A OUT[ n ] | Connected to:   |
|-------------------|-----------------|
|                 0 | N/C 1           |
|                 1 | N/C             |
|                 2 | N/C             |
|                 3 | N/C             |
|                 4 | N/C             |
|                 5 | N/C             |
|                 6 | N/C             |
|                 7 | N/C             |
|                 8 | N/C             |
|                 9 | N/C             |
|                10 | N/C             |
|                11 | N/C             |
|                12 | N/C             |
|                13 | N/C             |

## Table 20-19. DSPI\_A Connectivity Table  (continued)

|   DSPI_A IN[ n ] | Connected to:           |
|------------------|-------------------------|
|               14 | eTPU_B Output Channel 1 |
|               15 | eTPU_B Output Channel 0 |

|   DSPI_A OUT[ n ] | Connected to:   |
|-------------------|-----------------|
|                14 | N/C             |
|                15 | N/C             |

1 Not Connected

## 20.4.4.6.2 DSPI\_B Connectivity (MPC5554 and MPC5553)

The DSPI\_B connects to the EMIOS, eTPU\_A, and SIU as shown in Figure 20-22.

Figure 20-22. DSPI\_B Connectivity

<!-- image -->

| EMIOS                                  |             | DSPI_B                       | DSPI_B                         | SIU/IMUX                          |
|----------------------------------------|-------------|------------------------------|--------------------------------|-----------------------------------|
| CH 11 CH 10 CH 13 CH 12                | IN IN IN IN | 0 1 14 15                    | OUT 0 OUT 15 • •               | IN1 IRQ[0] IN1 IRQ[15] • •        |
| eTPU_A CH 21 CH 16 • • CH 29 CH 24 • • | • • • •     | IN 2 IN 7 IN 8 IN 13 • • • • | OUT 14 OUT 15 OUT 8 OUT 13 • • | EMIOS CH 13 CH 29 CH 24 • • CH 12 |

Table 20-20 lists the DSPI\_B connections.

## Table 20-20. DSPI\_B Connectivity Table

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

|   DSPI_B IN[ n ] | Connected to:            |
|------------------|--------------------------|
|                0 | EMIOS Output Channel 11  |
|                1 | EMIOS Output Channel 10  |
|                2 | eTPU_A Output Channel 21 |
|                3 | eTPU_A Output Channel 20 |
|                4 | eTPU_A Output Channel 19 |
|                5 | eTPU_A Output Channel 18 |
|                6 | eTPU_A Output Channel 17 |
|                7 | eTPU_A Output Channel 16 |
|                8 | eTPU_A Output Channel 29 |
|                9 | eTPU_A Output Channel 28 |
|               10 | eTPU_A Output Channel 27 |

|   DSPI_B OUT[ n ] | Connected to:                                                 |
|-------------------|---------------------------------------------------------------|
|                 0 | Input 1 on IMUX for External IRQ[0]                           |
|                 1 | Input 1 on IMUX for External IRQ[1]                           |
|                 2 | Input 1 on IMUX for External IRQ[2]                           |
|                 3 | Input 1 on IMUX for External IRQ[3]                           |
|                 4 | Input 1 on IMUX for External IRQ[4]                           |
|                 5 | Input 1 on IMUX for External IRQ[5]                           |
|                 6 | Input 1 on IMUX for External IRQ[6]                           |
|                 7 | Input 1 on IMUX for External IRQ[7]                           |
|                 8 | eTPU_A Input Channel 29, Input 1 on IMUX for External IRQ[8]  |
|                 9 | eTPU_A Input Channel 28, Input 1 on IMUX for External IRQ[9]  |
|                10 | eTPU_A Input Channel 27, Input 1 on IMUX for External IRQ[10] |

Table 20-20. DSPI\_B Connectivity Table  (continued)

|   DSPI_B IN[ n ] | Connected to:            |
|------------------|--------------------------|
|               11 | eTPU_A Output Channel 26 |
|               12 | eTPU_A Output Channel 25 |
|               13 | eTPU_A Output Channel 24 |
|               14 | EMIOS Output Channel 13  |
|               15 | EMIOS Output Channel 12  |

|   DSPI_B OUT[ n ] | Connected to:                                                 |
|-------------------|---------------------------------------------------------------|
|                11 | eTPU_A Input Channel 26, Input 1 on IMUX for External IRQ[11] |
|                12 | eTPU_A Input Channel 25, Input 1 on IMUX for External IRQ[12] |
|                13 | eTPU_A Input Channel 24, Input 1 on IMUX for External IRQ[13] |
|                14 | EMIOS Input Channel 13, Input 1 on IMUX for External IRQ[14]  |
|                15 | EMIOS Input Channel 12, Input 1 on IMUX for External IRQ[15]  |

## 20.4.4.6.3 DSPI\_C Connectivity (MPC5554 and MPC5553)

The DSPI\_C connects to eTPU\_A and SIU as shown in Figure 20-23.

Figure 20-23. DSPI\_C Connectivity

<!-- image -->

Table 20-21 lists the DSPI\_C connections.

Table 20-21. DSPI\_C Connectivity Table

|   DSPI_C IN[ n ] | Connected to:            |
|------------------|--------------------------|
|                0 | eTPU_A Output Channel 12 |
|                1 | eTPU_A Output Channel 13 |
|                2 | eTPU_A Output Channel 14 |
|                3 | eTPU_A Output Channel 15 |
|                4 | eTPU_A Output Channel 0  |
|                5 | eTPU_A Output Channel 1  |
|                6 | eTPU_A Output Channel 2  |
|                7 | eTPU_A Output Channel 3  |
|                8 | eTPU_A Output Channel 4  |
|                9 | eTPU_A Output Channel 5  |
|               10 | eTPU_A Output Channel 6  |
|               11 | eTPU_A Output Channel 7  |

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

|   DSPI_C OUT[ n ] | Connected to:                        |
|-------------------|--------------------------------------|
|                 0 | Input 2 on IMUX for External IRQ[15] |
|                 1 | Input 2 on IMUX for External IRQ[0]  |
|                 2 | Input 2 on IMUX for External IRQ[1]  |
|                 3 | Input 2 on IMUX for External IRQ[2]  |
|                 4 | Input 2 on IMUX for External IRQ[3]  |
|                 5 | Input 2 on IMUX for External IRQ[4]  |
|                 6 | Input 2 on IMUX for External IRQ[5]  |
|                 7 | Input 2 on IMUX for External IRQ[6]  |
|                 8 | Input 2 on IMUX for External IRQ[7]  |
|                 9 | Input 2 on IMUX for External IRQ[8]  |
|                10 | Input 2 on IMUX for External IRQ[9]  |
|                11 | Input 2 on IMUX for External IRQ[10] |

## Functional Description

## Table 20-21. DSPI\_C Connectivity Table  (continued)

|   DSPI_C IN[ n ] | Connected to:            |
|------------------|--------------------------|
|               12 | eTPU_A Output Channel 8  |
|               13 | eTPU_A Output Channel 9  |
|               14 | eTPU_A Output Channel 10 |
|               15 | eTPU_A Output Channel 11 |

|   DSPI_C OUT[ n ] | Connected to:                        |
|-------------------|--------------------------------------|
|                12 | Input 2 on IMUX for External IRQ[11] |
|                13 | Input 2 on IMUX for External IRQ[12] |
|                14 | Input 2 on IMUX for External IRQ[13] |
|                15 | Input 2 on IMUX for External IRQ[14] |

## 20.4.4.6.4 DSPI\_D Connectivity (MPC5554 and MPC5553)

The DSPI\_D connects to the eTPU\_A, EMIOS and SIU as shown in Figure 20-24.

Figure 20-24. DSPI\_D Connectivity

<!-- image -->

Table 20-22 lists the DSPI\_D connections.

## Table 20-22. DSPI\_D Connectivity Table

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

|   DSPI_D IN[ n ] | Connected to:            |
|------------------|--------------------------|
|                0 | eTPU_A Output Channel 21 |
|                1 | eTPU_A Output Channel 20 |
|                2 | eTPU_A Output Channel 19 |
|                3 | eTPU_A Output Channel 18 |
|                4 | eTPU_A Output Channel 17 |
|                5 | eTPU_A Output Channel 16 |
|                6 | EMIOS Output Channel 11  |
|                7 | EMIOS Output Channel 10  |
|                8 | EMIOS Output Channel 13  |
|                9 | EMIOS Output Channel 12  |
|               10 | eTPU_A Output Channel 29 |
|               11 | eTPU_A Output Channel 28 |

|   DSPI_D OUT[ n ] | Connected to:                        |
|-------------------|--------------------------------------|
|                 0 | Input 3 on IMUX for External IRQ[14] |
|                 1 | Input 3 on IMUX for External IRQ15]  |
|                 2 | N/C                                  |
|                 3 | N/C                                  |
|                 4 | Input 3 on IMUX for External IRQ[2]  |
|                 5 | Input 3 on IMUX for External IRQ[3]  |
|                 6 | Input 3 on IMUX for External IRQ[4]  |
|                 7 | Input 3 on IMUX for External IRQ[5]  |
|                 8 | Input 3 on IMUX for External IRQ[6]  |
|                 9 | Input 3 on IMUX for External IRQ[7]  |
|                10 | Input 3 on IMUX for External IRQ[8]  |
|                11 | Input 3 on IMUX for External IRQ[9]  |

Table 20-22. DSPI\_D Connectivity Table  (continued)

|   DSPI_D IN[ n ] | Connected to:            |
|------------------|--------------------------|
|               12 | eTPU_A Output Channel 27 |
|               13 | eTPU_A Output Channel 26 |
|               14 | eTPU_A Output Channel 25 |
|               15 | eTPU_A Output Channel 24 |

|   DSPI_D OUT[ n ] | Connected to:                                                |
|-------------------|--------------------------------------------------------------|
|                12 | Input 3 on IMUX for External IRQ[10]                         |
|                13 | Input 3 on IMUX for External IRQ[11]                         |
|                14 | EMIOS Input Channel 15, Input 3 on IMUX for External IRQ[12] |
|                15 | EMIOS Input Channel 14, Input 3 on IMUX for External IRQ[13] |

## 20.4.4.7 Multiple Transfer Operation (MTO)

In DSI configuration the MTO feature allows for multiple DSPIs within the MPC5553/MPC5554 to be chained together in a parallel or serial configuration. The parallel chaining allows multiple DSPIs internal to the MPC5553/MPC5554 and multiple SPI devices external to the MPC5553/MPC5554 to share SCK and  PCS  signals  thereby  saving  pins.  The  serial  chaining  allows  bits  from  multiple  DSPIs  to  be concatenated into a single DSI frame. MTO is enabled by setting the MTOE bit in the DSPI x \_DSICR.

In parallel and serial chaining there is one bus master and multiple bus slaves. The bus master initiates and controls  the  transfers,  but  the  DSPI  slaves  generate  trigger  signals  for  the  bus  DSPI  master  when  an internal condition in the slave warrants a transfer. The DSPI slaves also propagate triggers from other slaves to the master. When a DSPI slave detects a trigger signal on its ht input, the slave generates a trigger signal on the MTRIG output.

The SIU\_DISR must be configured to use serial or parallel chaining.

## 20.4.4.7.1 Internal Muxing/SIU Support for Serial and Parallel Chaining

To support MTO, each DSPI in MPC5553/MPC5554 has multiplexers on the SIN, SS, SCK, and ht inputs. The internal multiplexers are controlled by registers in the SIU block.

Figure 20-25 (MPC5553) shows DSPI\_B and four of the multiplexers in the IMUX subblock of the SIU. The SOUT, MTRIG, SCK and PCS0 outputs from the other two DSPIs connect to the multiplexers on the DSPI\_B inputs. DSPI\_C and DSPI\_D have similar multiplexers on their inputs.

Figure 20-26 (MPC5554) shows DSPI\_A and four of the multiplexers in the IMUX subblock of the SIU. The SOUT, MTRIG, SCK and PCS0 outputs from the other three DSPIs connect to the multiplexers on the DSPI\_A inputs. DSPI\_B, DSPI\_C and DSPI\_D have similar multiplexers on their inputs.

Figure 20-25. DSPI Input Select Muxes - MPC5553

<!-- image -->

Figure 20-26. DSPI Input Select Muxes - MPC5554

<!-- image -->

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

The source for the SIN input of a DSPI can be a pin or the SOUT of any of the other three (for the MPC5554) DSPIS or two (for the MPC5553) DSPIs. The source for the SS input of a DSPI can be a pin or the PCS0 signal from any of the other DSPIs. The source for the SCK input of a DSPI can be a pin or the SCK output of any of the other DSPIs. The source for the hardware trigger ( ht ) input can be the MTRIG signal from any of the other DSPIs. The DSPI input select register (SIU\_DSR) selects the source for each DSPI SIN, SS, SCK, and ht signal individually.

## 20.4.4.7.2 Parallel Chaining

Parallel chaining allows the PCS and SCK signals from a master DSPI to be shared by internal slave DSPIs and external slave SPI devices. Signal sharing reduces DSPI pin utilization. An example of a parallel chain is shown in Figure 20-27 (for the MPC5554) or Figure 20-28 (for the MPC5553).

Figure 20-27. Example of Parallel Chaining of DSPIs in the MPC5554

<!-- image -->

Figure 20-28. Example of Parallel Chaining of DSPIs in the MPC5553

<!-- image -->

In the parallel chaining example, the SOUT and SIN of the three DSPIs connect to separate external SPI devices. All internal and external SPI modules share PCS and SCK signals. In the MPC5554, DSPI\_A controls and initiates all transfers, but the DSPI slaves each have a trigger output signal MTRIG that indicates  to  DSPI\_A  that  a  trigger  condition  has  occurred  in  the  DSPI  slaves.  In  the  MPC5553,  it  is DSPI\_B that controls and initiates all transfers, but the DSPI slaves each have a trigger output signal MTRIG that indicates to DSPI\_B that a trigger condition has occurred in the DSPI slaves.

When the slave DSPI has a change in data to be serialized, it asserts the MTRIG signal that propagates to DSPI\_A  (MPC5554)/DSPI\_B  (MPC5553)  which  initiates  the  transfer.  In  the  MPC5554,  DSPI\_B propagates trigger signals from DSPI\_C to DSPI\_A. In the MPC5554, DSPI\_C propagates trigger signals from DSPI\_D to DSPI\_B.

The MTOCNT field in the DSPI \_DSICR must be written with the number of bits to be transferred. In x parallel  chaining  the  number  written  to  MTOCNT  must  match  the  FMSZ  field  in  the  selected DSPI \_CTAR. x

## 20.4.4.7.3 Serial Chaining

Serial chaining allows transfers of DSI frames consisting of concatenated bits from multiple DSPIs. The concatenated frames can be from 8 to 64 bits long. Figures 20-29 and 20-30 show an example of how the modules can be connected in the MPC5554/MPC5553, respectively.

Figure 20-29. Example of Serial Chaining of DSPIs in the MPC5554

<!-- image -->

Figure 20-30. Example of Serial Chaining of DSPIs in the MPC5553

<!-- image -->

In the MPC5554 (master), the SOUT of DSPI\_A is connected to the SIN of DSPI\_B (slave), and in the MPC5553 (master), the SOUT of DSPI\_B is connected to the SIN of DSPI\_C (slave). In the MPC5554, the SOUT of the DSPI\_B (slave) is connected to the SIN input of the DSPI\_C and so on (slave). In the MPC5553, the SOUT of the DSPI\_C (slave) is connected to the SIN input of the DSPI\_D and so on (slave). The SOUT of the last on-chip DSPI slave is connected to the SIN of the external SPI slave. The SOUT of the external SPI slave is connected to the SIN of DSPI\_A master (MPC5554)/DSPI\_B master (MPC5553).

The MPC5554 DSPI\_A master and the MPC5553 DSPI\_B master control and initiate all transfers, but the slave  DSPIs  use  the  trigger  output  signal  MTRIG  to  indicate  to  the  DSPI\_A  (MPC5554)  or  DSPI\_B

(MPC5553) master that a trigger condition has occurred. When an on-chip DSPI slave has a change in data to be serialized it can assert the MTRIG signal to the DSPI master which initiates the transfer. When a DSPI slave has its ht signal asserted it will assert its MTRIG signal thereby propagating trigger signals from other DSPI slaves to the DSPI master.

The MTOCNT field in the DSPI \_DSICR must be written with the total number of bits to be transferred. x The MTOCNT field must equal the sum of all FMSZ fields in the selected DSPI x \_CTARs for the DSPI master and all DSPI slaves. For example if one 16-bit DSI frame is created by concatenating 8 bits from the DSPI master, and 4 bits from each of the DSPI slaves in Figure 20-29, the DSPI master's frame size must be set to eight in the FMSZ field, and the DSPI slaves' frame size must be set to four. The largest DSI frame supported by the MTOCNT field is 64 bits (MPC5554) or 48 bits (MPC5553). Any number of DSPIs can be connected together to concatenate DSI frames, as long as each DSPI transfers a minimum of 4 bits and a maximum of 16 bits and the total size of the concatenated frame is less than or equal to 64 bits long (MPC5554) or 48 bits (MPC5553).

## 20.4.5 Combined Serial Interface (CSI) Configuration

In master mode, the CSI configuration of the DSPI is used to support SPI and DSI functions on a frame by frame basis. CSI configuration allows interleaving of DSI data frames from the parallel input signals (from the eTPU or eMIOS) with SPI commands and data from the TX FIFO. The data returned from the bus slave is either used to drive the parallel output signals (to the eTPU or eMIOS) or is stored in the RX FIFO. CSI configuration allows serialized data and configuration or diagnostic data to be transferred to a slave device using only one serial link. The DSPI is in CSI configuration when the DCONF field in the DSPI x \_MCR is 0b10. Figure 20-31 shows an example of how a DSPI can be used with a deserializing peripheral that supports SPI control for control and diagnostic frames.

Figure 20-31. Example of System using DSPI in CSI Configuration

<!-- image -->

In  CSI  configuration  the  DSPI  transfers  DSI  data  based  on  Section 20.4.4.5,  'DSI  Transfer  Initiation Control.' When there are SPI commands in the TX FIFO, the SPI data has priority over the DSI frames. When the TX FIFO is empty, DSI transfer resumes.

Two peripheral chip select signals indicate whether DSI data or SPI data is transmitted. The user must configure the DSPI so that the two CTARs associated with DSI data and SPI data assert different peripheral chip select signals denoted in the figure as PCSx and PCSy. The CSI configuration is only supported in master mode.

Data returned from the external slave while a DSI frame is transferred is placed on the parallel output signals. Data returned from the external slave while an SPI frame is transferred is moved to the RX FIFO. The TX FIFO and RX FIFO are fully functional in CSI mode.

## 20.4.5.1 CSI Serialization

Serialization  in  the  CSI  configuration  is  similar  to  serialization  in  DSI  configuration.  The  transfer attributes  for  SPI  frames  are  determined  by  the  DSPI x \_CTAR selected by the CTAS field in the SPI command  halfword.  The  transfer  attributes  for  the  DSI  frames  are  determined  by  the  DSPI x \_CTAR selected by the DSICTAS field in the DSPI x \_DSICR. Figure 20-32 shows the CSI serialization logic.

Figure 20-32. CSI Serialization Diagram

<!-- image -->

The parallel inputs signal states are latched into the DSPI x \_SDR on the rising edge of every system clock and serialized based on the transfer initiation control settings in the DSPI x \_DSICR. For more information on the DSPI \_SDR, refer to Section 20.3.2.11, 'DSPI DSI Serialization Data Register (DSPIx\_SDR).' x SPI frames written to the TX FIFO have priority over DSI data from the DSPI x \_SDR and are transferred at  the  next  frame  boundary.  A  copy  of  the  most  recently  transferred  DSI  frame  is  stored  in  the DSPI \_COMPR.  The  transfer  priority  logic  selects  the  source  of  the  serialized  data  and  asserts  the x appropriate CS signal.

## 20.4.5.2 CSI Deserialization

The deserialized frames in CSI configuration go into the DSPI x \_SDR or the RX FIFO based on the transfer priority logic. When DSI frames are transferred the returned frames are deserialized and latched into the DSPI \_DDR. When SPI frames are transferred the returned frames are deserialized and written to the RX x FIFO. Figure 20-33 shows the CSI deserialization logic.

## Slave Bus Interface

Figure 20-33. CSI Deserialization Diagram

<!-- image -->

## 20.4.6 DSPI Baud Rate and Clock Delay Generation

The SCK frequency and the delay values for serial transfer are generated by dividing the system clock frequency by a prescaler and  a  scaler  with  the  option  of  doubling  the  baud  rate.  Figure 20-34  shows conceptually how the SCK signal is generated.

Figure 20-34. Communications Clock Prescalers and Scalers

<!-- image -->

## 20.4.6.1 Baud Rate Generator

The baud rate is the frequency of the serial communication clock (SCK). The system clock is divided by a baud rate prescaler (defined by DSPI \_CTAR[PBR]) x and baud rate scaler (defined by DSPI \_CTAR[BR]) to produce SCK with the possibility of doubling the baud rate. The DBR, PBR, and x BR fields in the DSPI x \_CTARs select the frequency of SCK using the following formula:

Table 20-23 shows an example of a computed baud rate.

<!-- image -->

Table 20-23. Baud Rate Computation Example

| f SYS   | PBR   |   Prescaler Value | BR     |   Scaler Value |   DBR Value | Baud Rate   |
|---------|-------|-------------------|--------|----------------|-------------|-------------|
| 100 MHz | 0b00  |                 2 | 0b0000 |              2 |           0 | 25 Mb/s     |
| 20 MHz  | 0b00  |                 2 | 0b0000 |              2 |           1 | 10 Mb/s     |

## 20.4.6.2 PCS to SCK Delay (t CSC )

The PCS to SCK delay is the length of time from assertion of the PCS signal to the first SCK edge. See Figure 20-36  for  an  illustration  of  the  PCS  to  SCK  delay.  The  PCSSCK  and  CSSCK  fields  in  the

DSPI \_CTAR  registers select the PCS to SCK delay, and the relationship is expressed by the following x n formula:

<!-- formula-not-decoded -->

Table 20-24 shows an example of the computed PCS to SCK delay.

Table 20-24. PCS to SCK Delay Computation Example

| PCSSCK   |   Prescaler Value | CSSCK   |   Scaler Value | f SYS   | PCS to SCK Delay   |
|----------|-------------------|---------|----------------|---------|--------------------|
| 0b01     |                 3 | 0b0100  |             32 | 100 MHz | 0.96 µ s           |

## 20.4.6.3 After SCK Delay (t ASC )

The after SCK delay is the length of time between the last edge of SCK and the negation of PCS. See Figure 20-36 and Figure 20-37 for illustrations of the after SCK delay. The PASC and ASC fields in the DSPI \_CTAR  registers select the after SCK delay. The relationship between these variables is given in x n the following formula:

<!-- formula-not-decoded -->

Table 20-25 shows an example of the computed after SCK delay.

Table 20-25. After SCK Delay Computation Example

| PASC   |   Prescaler Value | ASC    |   Scaler Value | Fsys    | After SCK Delay   |
|--------|-------------------|--------|----------------|---------|-------------------|
| 0b01   |                 3 | 0b0100 |             32 | 100 MHz | 0.96 us           |

## 20.4.6.4 Delay after Transfer (t DT )

The delay after transfer is the length of time between negation of the PCS signal for a frame and the assertion  of  the  PCS  signal  for  the  next  frame.  See  Figure 20-36  for  an  illustration  of  the  delay  after transfer.  The  PDT  and  DT  fields  in  the  DSPI x \_CTAR  registers  select  the  delay  after  transfer.  The n following formula expresses the PDT/DT/delay after transfer relationship:

<!-- formula-not-decoded -->

Table 20-26 shows an example of the computed delay after transfer.

Table 20-26. Delay after Transfer Computation Example

| PDT   |   Prescaler Value | DT     |   Scaler Value | f SYS   | Delay after Transfer   |
|-------|-------------------|--------|----------------|---------|------------------------|
| 0b01  |                 3 | 0b1110 |          32768 | 100 MHz | 0.98 ms                |

## 20.4.6.5 Peripheral Chip Select Strobe Enable (PCSS)

The PCSS signal provides a delay to allow the PCS signals to settle after transitioning thereby avoiding glitches. When the DSPI is in master mode and PCSSE bit is set in the DSPI x \_MCR, PCSS provides a signal for an external demultiplexer to decode the PCS[0:4] signals into as many as 32 glitch-free PCS signals. Figure 20-35 shows the timing of the PCSS signal relative to PCS signals.

Figure 20-35. Peripheral Chip Select Strobe Timing

<!-- image -->

The delay between the assertion of the PCS signals and the assertion of PCSS is selected by the PCSSCK field in the DSPI x \_CTAR based on the following formula:

<!-- formula-not-decoded -->

At the end of the transfer the delay between PCSS negation and PCS negation is selected by the PASC field in the DSPI x \_CTAR based on the following formula:

<!-- formula-not-decoded -->

Table 20-27 shows an example of the computed t PCSSCK  delay.

Table 20-27. Peripheral Chip Select Strobe Assert Computation Example

| PCSSCK   |   Prescaler | f SYS   | Delay before Transfer   |
|----------|-------------|---------|-------------------------|
| 0b11     |           7 | 100 MHz | 70.0 ns                 |

Table 20-28 shows an example of the computed the t PASC  delay

.

Table 20-28. Peripheral Chip Select Strobe Negate Computation Example

| PASC   |   Prescaler | f SYS   | Delay after Transfer   |
|--------|-------------|---------|------------------------|
| 0b11   |           7 | 100 MHz | 70.0 ns                |

## 20.4.7 Transfer Formats

The SPI serial communication is controlled by the serial communications clock (SCK) signal and the PCS signals. The SCK signal provided by the master device synchronizes shifting and sampling of the data by the SIN and SOUT pins. The PCS signals serve as enable signals for the slave devices.

When the DSPI is the bus master, the CPOL and CPHA bits in the DSPI clock and transfer attributes registers (DSPI x \_CTAR ) select the polarity and phase of the serial clock, SCK. The polarity bit selects n

the idle state of the SCK. The clock phase bit selects if the data on SOUT is valid before or on the first SCK edge.

When the  DSPI  is  the  bus  slave,  CPOL  and  CPHA  bits  in  the  DSPI x \_CTAR0 (SPI  slave  mode)  or DSPI \_CTAR1 (DSI slave mode) select the polarity and phase of the serial clock.  Even though the bus x slave does not control the SCK signal, clock polarity, clock phase and number of bits to transfer must be identical for the master device and the slave device to ensure proper transmission.

The DSPI supports four different transfer formats:

- · Classic SPI with CPHA = 0
- · Classic SPI with CPHA = 1
- · Modified transfer format with CPHA = 0
- · Modified transfer format with CPHA = 1

A modified transfer format is supported to allow for high-speed communication with peripherals that require longer setup times. The DSPI can sample the incoming data later than halfway through the cycle to give the peripheral more setup time. The MTFE bit in the DSPI x \_MCR selects between classic SPI format and modified transfer format. The classic SPI formats are described in Section 20.4.7.1, 'Classic SPI Transfer Format (CPHA = 0)' and Section 20.4.7.2, 'Classic SPI Transfer Format (CPHA = 1).' The modified transfer formats are described in Section 20.4.7.3, 'Modified SPI/DSI Transfer Format (MTFE = 1, CPHA = 0)' and Section 20.4.7.4, 'Modified SPI/DSI Transfer Format (MTFE = 1, CPHA = 1).'

In the SPI and DSI configurations, the DSPI provides the option of keeping the PCS signals asserted between frames. See Section 20.4.7.5, 'Continuous Selection Format' for details.

## 20.4.7.1 Classic SPI Transfer Format (CPHA = 0)

The transfer format shown in Figure 20-36 is used to communicate with peripheral SPI slave devices where the first data bit is available on the first clock edge. In this format, the master and slave sample their SIN pins on the odd-numbered SCK edges and change the data on their SOUT pins on the even-numbered SCK edges.

Figure 20-36. DSPI Transfer Timing Diagram (MTFE = 0, CPHA = 0, FMSZ = 8)

<!-- image -->

The master initiates the transfer by placing its first data bit on the SOUT pin and asserting the appropriate peripheral chip select signals to the slave device. The slave responds by placing its first data bit on its SOUT pin. After the t CSC  delay has elapsed, the master outputs the first edge of SCK. This is the edge used by the master and slave devices to sample the first input data bit on their serial data input signals. At the second edge of the SCK the master and slave devices place their second data bit on their serial data output signals. For the rest of the frame the master and the slave sample their SIN pins on the odd-numbered clock edges and changes the data on their SOUT pins on the even-numbered clock edges. After the last clock edge occurs a delay of t ASC  is inserted before the master negates the PCS signals. A delay of t DT  is inserted before a new frame transfer can be initiated by the master.

For the CPHA =0 conditon of the master, TCF and EOQF are set and the RXCTR counter is updated at the next to last serial clock edge of the frame (edge 15) of Figure 20-36.

For the CPHA=0 condition of the slave, TCF is set and the RXCTR counter is updated at the last serial clock edge of the frame (edge 16) of Figure 20-36.

## 20.4.7.2 Classic SPI Transfer Format (CPHA = 1)

This transfer format shown in Figure 20-37 is used to communicate with peripheral SPI slave devices that require the first SCK edge before the first data bit becomes available on the slave SOUT pin. In this format the master and slave devices change the data on their SOUT pins on the odd-numbered SCK edges and sample the data on their SIN pins on the even-numbered SCK edges.

<!-- image -->

t

DT

= Delay after transfer (minimum CS negation time).

Figure 20-37. DSPI Transfer Timing Diagram (MTFE = 0, CPHA = 1, FMSZ = 8)

The master initiates the transfer by asserting the PCS signal to the slave. After the t CSC delay has elapsed, the master generates the first SCK edge and at the same time places valid data on the master SOUT pin. The slave responds to the first SCK edge by placing its first data bit on its slave SOUT pin.

At the second edge of the SCK the master and slave sample their SIN pins. For the rest of the frame the master and the slave change the data on their SOUT pins on the odd-numbered clock edges and sample their SIN pins on the even-numbered clock edges. After the last clock edge occurs a delay of t ASC  is inserted before the master negates the PCS signal. A delay of t DT  is inserted before a new frame transfer can be initiated by the master.

For CPHA=1 the master EOQF and TCF and slave TCF are set at the last serial clock edge (edge 16) of Figure 20-37. For CPHA=1 the master and slave RXCTR counters are updated on the same clock edge.

## 20.4.7.3 Modified SPI/DSI Transfer Format (MTFE = 1, CPHA = 0)

In this modified transfer format both the master and the slave sample later in the SCK period than in classic SPI mode to allow for delays in device pads and board traces. These delays become a more significant fraction of the SCK period as the SCK period decreases with increasing baud rates.

## NOTE

For  correct  operation  of  the  modified  transfer  format,  the  user  must thoroughly analyze the SPI link timing budget.

The master and the slave place data on the SOUT pins at the assertion of the PCS signal. After the PCS to SCK delay has elapsed the first SCK edge is generated. The slave samples the master SOUT signal on every odd numbered SCK edge. The slave also places new data on the slave SOUT on every odd numbered clock edge.

The master places its second data bit on the SOUT line one system clock after odd numbered SCK edge. The point where the master samples the slave SOUT is selected by writing to the SMPL\_PT field in the DSPI \_MCR. Table 20-29 lists the number of system clock cycles between the active edge of SCK and x the master sample point for different values of the SMPL\_PT bit field. The master sample point can be delayed by one or two system clock cycles.

Table 20-29. Delayed Master Sample Point

|   SMPL_PT | Number of System Clock Cycles between Odd-numbered Edge of SCKandSampling of SIN   |
|-----------|------------------------------------------------------------------------------------|
|        00 | 0                                                                                  |
|        01 | 1                                                                                  |
|        10 | 2                                                                                  |
|        11 | Reserved                                                                           |

Figure 20-38 shows the modified transfer format for CPHA = 0. Only the condition where CPOL = 0 is illustrated. The delayed master sample points are indicated with a lighter shaded arrow.

Figure 20-38. DSPI Modified Transfer Format (MTFE = 1, CPHA = 0, Fsck = Fsys/4)

<!-- image -->

## 20.4.7.4 Modified SPI/DSI Transfer Format (MTFE = 1, CPHA = 1)

Figure 20-39 shows the modified transfer format for CPHA = 1. Only the condition where CPOL = 0 is described. At the start of a transfer the DSPI asserts the PCS signal to the slave device. After the PCS to SCK delay has elapsed the master and the slave put data on their SOUT pins at the first edge of SCK. The slave samples the master SOUT signal on the even numbered edges of SCK. The master samples the slave SOUT signal on the odd numbered SCK edges starting with the 3rd SCK edge. The slave samples the last bit on the last edge of the SCK. The master samples the last slave SOUT bit one half SCK cycle after the last edge of SCK. No clock edge will be visible on the master SCK pin during the sampling of the last bit. The SCK to PCS delay must be greater or equal to half of the SCK period.

## NOTE

For  correct  operation  of  the  modified  transfer  format,  the  user  must thoroughly analyze the SPI link timing budget.

Figure 20-39. DSPI Modified Transfer Format (MTFE = 1, CPHA = 1, Fsck = Fsys/4)

<!-- image -->

## 20.4.7.5 Continuous Selection Format

Some peripherals  must  be  deselected  between  every  transfer.  Other  peripherals  must  remain  selected between several sequential serial transfers. The continuous selection format provides the flexibility to handle both cases. The continuous selection format is enabled for the SPI configuration by setting the CONT bit in the SPI command. Continuous selection is enabled for the DSI configuration by setting the DCONT bit in the DSPI \_DSICR. The behavior of the PCS signals in the two configurations is identical x so only SPI configuration will be described.

When the CONT bit = 0, the DSPI drives the asserted chip select signals to their idle states in between frames. The idle states of the chip select signals are selected by the PCSIS field in the DSPI x \_MCR. Figure 20-40 shows the timing diagram for two four-bit transfers with CPHA = 1 and CONT =  0.

Figure 20-40. Example of Non-Continuous Format (CPHA=1, CONT=0)

<!-- image -->

When the CONT = 1 and the PCS signal for the next transfer is the same as for the current transfer, the PCS signal remains asserted for the duration of the two transfers. The delay between transfers (t DT ) is not inserted between the transfers. Figure 20-41 shows the timing diagram for two four-bit transfers with CPHA  = 1 and CONT = 1.

Figure 20-41. Example of Continuous Transfer (CPHA = 1, CONT = 1)

<!-- image -->

In Figure 20-41, note that the period length at the start of the next transfer is the sum of t ASC  and t CSC ; i.e., it does not include a half-clock period. The default settings for these provide a total of four system clocks. In many situations, t ASC  and t CSC  must be increased if a full half-clock period is required.

Switching CTARs between frames while using continuous selection can cause errors in the transfer. The PCS signal must be negated before CTAR is switched.

When the CONT bit = 1 and the PCS signals for the next transfer are different from the present transfer, the PCS signals behave as if the CONT bit was not set.

## 20.4.7.6 Clock Polarity Switching between DSPI Transfers

If it is desired to switch polarity between non-continuous DSPI frames, the edge generated by the change in the idle state of the clock occurs one system clock before the assertion of the chip select for the next frame. In Figure 20-42, time 'A' shows the one clock interval. Time 'B' is user programmable from a

minimum of 2 system clocks. Refer to Section 20.3.2.3, 'DSPI Clock and Transfer Attributes Registers 0-7 (DSPIx\_CTARn).'

Figure 20-42. Polarity Switching between Frames

<!-- image -->

## 20.4.8 Continuous Serial Communications Clock

The DSPI provides the option of generating a continuous SCK signal for slave peripherals that require a continuous clock.

Continuous SCK is enabled by setting the CONT\_SCKE bit in the DSPI x \_MCR. Continuous SCK is valid in all configurations.

Continuous SCK is only supported for CPHA = 1. Setting CPHA = 0 will be ignored if the CONT\_SCKE bit is set. Continuous SCK is supported for modified transfer format.

Clock and transfer attributes for the continuous SCK mode are set according to the following rules:

- · When the DSPI is in SPI configuration, CTAR0 shall be used initially. At the start of each SPI frame transfer, the CTAR specified by the CTAS for the frame shall be used.
- · When the DSPI is in DSI configuration, the CTAR specified by the DSICTAS field shall be used at all times.
- · When the DSPI is in CSI configuration, the CTAR selected by the DSICTAS field shall be used initially. At the start of an SPI frame transfer, the CTAR specified by the CTAS value for the frame shall be used. At the start of a DSI frame transfer, the CTAR specified by the DSICTAS field shall be used.
- · In all configurations, the currently selected CTAR shall remain in use until the start of a frame with a different CTAR specified, or the continuous SCK mode is terminated.

It is recommended that the baud rate is the same for all transfers made while using the continuous SCK. Switching clock polarity between frames while using continuous SCK can cause errors in the transfer. Continuous SCK operation is not guaranteed if the DSPI is put into module disable mode.

Enabling continuous SCK disables the PCS to SCK delay and the After SCK delay. The delay after transfer is fixed at one SCK cycle. Figure 20-43 shows timing diagram for continuous SCK format with continuous selection disabled.

Figure 20-43. Continuous SCK Timing Diagram (CONT=0)

<!-- image -->

If the CONT bit in the TX FIFO entry is set or the DCONT in the DSPI x \_DSICR is set, PCS remains asserted between the transfers when the PCS signal for the next transfer is the same as for the current transfer.  Figure 20-44  shows  timing  diagram  for  continuous  SCK  format  with  continuous  selection enabled.

Figure 20-44. Continuous SCK Timing Diagram (CONT=1)

<!-- image -->

## 20.4.9 Interrupts/DMA Requests

The DSPI has five conditions which can only generate interrupt requests and two conditions that can generate interrupt or DMA request. Table 20-30 lists the six conditions.

Table 20-30. Interrupt and DMA Request Conditions

| Condition                                    | Flag         | Interrupt   | DMA   |
|----------------------------------------------|--------------|-------------|-------|
| End of transfer queue has been reached (EOQ) | EOQF         | X           |       |
| TX FIFO is not full                          | TFFF         | X           | X     |
| Current frame transfer is complete           | TCF          | X           |       |
| TX FIFO underflow has occurred               | TFUF         | X           |       |
| RX FIFO is not empty                         | RFDF         | X           | X     |
| RX FIFO overflow has occurred                | RFOF         | X           |       |
| A FIFO overrun has occurred 1                | TFUF OR RFOF | X           |       |

MPC5553/MPC5554 Microcontroller Reference Manual, Rev. 3.1

- 1 The FIFO Overrun condition is created by OR-ing the TFUF and RFOF flags together.

Each condition has a flag bit and a request enable bit. The flag bits are described in the Section 20.3.2.4, 'DSPI Status Register (DSPIx\_SR)' and the request enable bits are described in the Section 20.3.2.5, 'DSPI  DMA/Interrupt  Request  Select  and  Enable  Register  (DSPIx\_RSER).'  The  TX  FIFO  fill  flag (TFFF) and RX FIFO drain flag (RFDF) generate interrupt requests or DMA requests depending on the TFFF\_DIRS and RFDF\_DIRS bits in the DSPI \_RSER. x

## 20.4.9.1 End of Queue Interrupt Request (EOQF)

The end of queue equest indicates that the end of a transmit queue is reached. The end of queue request is generated when the EOQ bit in the executing SPI command is asserted and the EOQF\_RE bit in the DSPI \_RSER  is  asserted.  See  the  EOQ  bit  description  in  Section 20.3.2.4,  'DSPI  Status  Register x (DSPIx\_SR).' Refer to Figure 20-36 and Figure 20-37 that illustrate when EOQF is set.

## 20.4.9.2 Transmit FIFO Fill Interrupt or DMA Request (TFFF)

The transmit FIFO fill request indicates that the TX FIFO is not full. The transmit FIFO fill request is generated when the number of entries in the TX FIFO is less than the maximum number of possible entries, and the TFFF\_RE bit in the DSPI \_RSER is asserted. The TFFF\_DIRS bit in the DSPI x x \_RSER selects whether a DMA request or an interrupt request is generated.

## 20.4.9.3 Transfer Complete Interrupt Request (TCF)

The transfer complete request indicates the end of the transfer of a serial frame. The transfer complete request is generated at the end of each frame transfer when the TCF\_RE bit is set in the DSPI x \_RSER. See the TCF bit description in Section 20.3.2.4, 'DSPI Status Register (DSPIx\_SR).' Refer to Figure 20-36 and Figure 20-37 that illustrate when TCF is set.

## 20.4.9.4 Transmit FIFO Underflow Interrupt Request (TFUF)

The transmit FIFO underflow request indicates that an underflow condition in the TX FIFO has occurred. The transmit underflow condition is detected only for DSPI modules operating in slave mode and SPI configuration.  The  TFUF  bit  is  set  when  the  TX  FIFO  of  a  DSPI  operating  in  slave  mode  and  SPI configuration is empty, and a transfer is initiated from an external SPI master. If the TFUF bit is set while the TFUF\_RE bit in the DSPI \_RSER is asserted, an interrupt request is generated. x

## 20.4.9.5 Receive FIFO Drain Interrupt or DMA Request (RFDF)

The receive FIFO drain request indicates that the RX FIFO is not empty. The receive FIFO drain request is  generated  when  the  number  of  entries  in  the  RX  FIFO  is  not  zero,  and  the  RFDF\_RE  bit  in  the DSPI \_RSER is asserted. The RFDF\_DIRS bit in the DSPI x x \_RSER selects whether a DMA request or an interrupt request is generated.

## 20.4.9.6 Receive FIFO Overflow Interrupt Request (RFOF)

The receive FIFO overflow request indicates that an overflow condition in the RX FIFO has occurred. A receive FIFO overflow request is generated when RX FIFO and shift register are full and a transfer is initiated. The RFOF\_RE bit in the DSPI x \_RSER must be set for the interrupt request to be generated.

Deserial Serial Peripheral Interface (DSPI)

Depending on the state of the ROOE bit in the DSPI x \_MCR, the data from the transfer that generated the overflow is either ignored or shifted in to the shift register. If the ROOE bit is set, the incoming data is shifted in to the shift register. If the ROOE bit is negated, the incoming data is ignored.

## 20.4.9.7 FIFO Overrun Request (TFUF) or (RFOF)

The FIFO overrun request indicates that at least one of the FIFOs in the DSPI has exceeded its capacity. The FIFO overrun request is generated by logically OR'ing together the RX FIFO overflow and TX FIFO underflow signals.

## 20.4.10 Power Saving Features

The DSPI supports two power-saving strategies:

- · Module disable mode-clock gating of non-memory mapped logic
- · Clock gating of slave interface signals and clock to memory-mapped logic

## 20.4.10.1 Module Disable Mode

Module disable mode is a module-specific mode that the DSPI can enter to save power. Host software can initiate the module disable mode by writing a 1 to the MDIS bit in the DSPI x \_MCR. In module disable mode, the DSPI is in a dormant state, but the memory mapped registers are still accessible. Certain read or write operations have a different affect when the DSPI is in the module disable mode. Reading the RX FIFO pop register will not change the state of the RX FIFO. Likewise, writing to the TX FIFO push register will not change the state of the TX FIFO. Clearing either of the FIFOs will not have any affect in the module disable mode. Changes to the DIS\_TXF and DIS\_RXF fields of the DSPI \_MCR will not have x any affect in the module disable mode. In the module disable mode, all status bits and register flags in the DSPI will return the correct values when read, but writing to them will have no affect. Writing to the DSPI \_TCR during module disable mode will not have any affect. Interrupt and DMA request signals x cannot be cleared while in the module disable mode.

## 20.4.10.2 Slave Interface Signal Gating

The DSPI's module enable signal is used to gate slave interface signals such as address, byte enable, read/write and data. This prevents toggling slave interface signals from consuming power unless the DSPI is accessed.

## 20.5 Initialization/Application Information

## 20.5.1 How to Change Queues

DSPI  queues  are  not  part  of  the  DSPI  module,  but  the  DSPI  includes  features  in  support  of  queue management. Queues are primarily supported in SPI configuration. This section presents an example of how to change queues for the DSPI.

- 1. The last command word from a queue is executed. The EOQ bit in the command word is set to indicate to the DSPI that this is the last entry in the queue.
- 2. At the end of the transfer, corresponding to the command word with EOQ set is sampled, the EOQ flag (EOQF) in the DSPI x \_SR is set.

- 3. The setting of the EOQF flag will disable both serial transmission, and serial reception of data, putting the DSPI in the STOPPED state. The TXRXS bit is negated to indicate the STOPPED state.
- 4. The eDMA will continue to fill TX FIFO until it is full or step 5 occurs.
- 5. Disable DSPI DMA transfers by disabling the DMA enable request for the DMA channel assigned to TX FIFO and RX FIFO. This is done by clearing the corresponding DMA enable request bits in the eDMA controller.
- 6. Ensure all received data in RX FIFO has been transferred to memory receive queue by reading the RXCNT in DSPI \_SR or by checking RFDF in the DSPI \_SR after each read operation of the x x DSPI \_POPR. x
- 7. Modify DMA descriptor of TX and RX channels for 'new' queues.
- 8. Flush TX FIFO by writing a 1 to the CLR\_TXF bit in the DSPI x \_MCR, Flush RX FIFO by writing a 1 to the CLR\_RXF bit in the DSPI x \_MCR.
- 9. Clear transfer count either by setting CTCNT bit in the command word of the first entry in the new queue or via CPU writing directly to SPI\_TCNT field in the DSPI x \_TCR.
- 10. Enable DMA channel by enabling the DMA enable request for the DMA channel assigned to the DSPI TX FIFO, and RX FIFO by setting the corresponding DMA set enable request bit.
- 11. Enable serial transmission and serial reception of data by clearing the EOQF bit.

## 20.5.2 Baud Rate Settings

Table 20-31 shows the baud rate that is generated based on the combination of the baud rate prescaler PBR and the baud rate scaler BR in the DSPI x \_CTARs. The values calculated assume a 100 MHz system frequency.

Table 20-31. Baud Rate Values

|       | Baud Rate Divider Prescaler Values (DSPI_CTAR[PBR])   | Baud Rate Divider Prescaler Values (DSPI_CTAR[PBR])   | Baud Rate Divider Prescaler Values (DSPI_CTAR[PBR])   | Baud Rate Divider Prescaler Values (DSPI_CTAR[PBR])   |
|-------|-------------------------------------------------------|-------------------------------------------------------|-------------------------------------------------------|-------------------------------------------------------|
|       | 2                                                     | 3                                                     | 5                                                     | 7                                                     |
| 2     | 25.0MHz                                               | 16.7MHz                                               | 10.0MHz                                               | 7.14MHz                                               |
| 4     | 12.5MHz                                               | 8.33MHz                                               | 5.00MHz                                               | 3.57MHz                                               |
| 6     | 8.33MHz                                               | 5.56MHz                                               | 3.33MHz                                               | 2.38MHz                                               |
| 8     | 6.25MHz                                               | 4.17MHz                                               | 2.50MHz                                               | 1.79MHz                                               |
| 16    | 3.12MHz                                               | 2.08MHz                                               | 1.25MHz                                               | 893kHz                                                |
| 32    | 1.56MHz                                               | 1.04MHz                                               | 625kHz                                                | 446kHz                                                |
| 64    | 781kHz                                                | 521kHz                                                | 312kHz                                                | 223kHz                                                |
| 128   | 391kHz                                                | 260kHz                                                | 156kHz                                                | 112kHz                                                |
| 256   | 195kHz                                                | 130kHz                                                | 78.1kHz                                               | 55.8kHz                                               |
| 512   | 97.7kHz                                               | 65.1kHz                                               | 39.1kHz                                               | 27.9kHz                                               |
| 1024  | 48.8kHz                                               | 32.6kHz                                               | 19.5kHz                                               | 14.0kHz                                               |
| 2048  | 24.4kHz                                               | 16.3kHz                                               | 9.77kHz                                               | 6.98kHz                                               |
| 4096  | 12.2kHz                                               | 8.14kHz                                               | 4.88kHz                                               | 3.49kHz                                               |
| 8192  | 6.10kHz                                               | 4.07kHz                                               | 2.44kHz                                               | 1.74kHz                                               |
| 16384 | 3.05kHz                                               | 2.04kHz                                               | 1.22kHz                                               | 872Hz                                                 |
| 32768 | 1.53kHz                                               | 1.02kHz                                               | 610Hz                                                 | 436Hz                                                 |

## 20.5.3 Delay Settings

Table 20-32 shows the values for the delay after transfer (t DT ) and CS to SCK delay (t CSC ) that can be generated  based  on  the  prescaler  values  and  the  scaler  values  set  in  the  DSPI x \_CTARs.  The  values calculated assume a 100 MHz system frequency.

Table 20-32. Delay Values

|       | Delay Prescaler Values (DSPI_CTAR[PBR])   | Delay Prescaler Values (DSPI_CTAR[PBR])   | Delay Prescaler Values (DSPI_CTAR[PBR])   | Delay Prescaler Values (DSPI_CTAR[PBR])   |
|-------|-------------------------------------------|-------------------------------------------|-------------------------------------------|-------------------------------------------|
|       | 1                                         | 3                                         | 5                                         | 7                                         |
| 2     | 20.0 ns                                   | 60.0 ns                                   | 100.0 ns                                  | 140.0 ns                                  |
| 4     | 40.0 ns                                   | 120.0 ns                                  | 200.0 ns                                  | 280.0 ns                                  |
| 8     | 80.0 ns                                   | 240.0 ns                                  | 400.0 ns                                  | 560.0 ns                                  |
| 16    | 160.0 ns                                  | 480.0 ns                                  | 800.0 ns                                  | 1.1 µ s                                   |
| 32    | 320.0 ns                                  | 960.0 ns                                  | 1.6 µ s                                   | 2.2 µ s                                   |
| 64    | 640.0 ns                                  | 1.9 µ s                                   | 3.2 µ s                                   | 4.5 µ s                                   |
| 128   | 1.3 µ s                                   | 3.8 µ s                                   | 6.4 µ s                                   | 9.0 µ s                                   |
| 256   | 2.6 µ s                                   | 7.7 µ s                                   | 12.8 µ s                                  | 17.9 µ s                                  |
| 512   | 5.1 µ s                                   | 15.4 µ s                                  | 25.6 µ s                                  | 35.8 µ s                                  |
| 1024  | 10.2 µ s                                  | 30.7 µ s                                  | 51.2 µ s                                  | 71.7 µ s                                  |
| 2048  | 20.5 µ s                                  | 61.4 µ s                                  | 102.4 µ s                                 | 143.4 µ s                                 |
| 4096  | 41.0 µ s                                  | 122.9 µ s                                 | 204.8 µ s                                 | 286.7 µ s                                 |
| 8192  | 81.9 µ s                                  | 245.8 µ s                                 | 409.6 µ s                                 | 573.4 µ s                                 |
| 16384 | 163.8 µ s                                 | 491.5 µ s                                 | 819.2 µ s                                 | 1.1 ms                                    |
| 32768 | 327.7 µ s                                 | 983.0 µ s                                 | 1.6 ms                                    | 2.3 ms                                    |
| 65536 | 655.4 µ s                                 | 2.0 ms                                    | 3.3 ms                                    | 4.6 ms                                    |

## 20.5.4 MPC5xx QSPI Compatibility with the DSPI

Table 20-33  shows  the  translation  of  commands  written  to  the  TX  FIFO  command  halfword  with commands written  to  the  command  RAM  of  the  MPC5xx  family  QSPI.  The  table  illustrates  how  to configure the DSPI \_CTARs to match the default cases for the possible combinations of the MPC5xx x family control bits in its command RAM. The defaults for the MPC5xx family are based on a system clock of 40MHz. All delay variables below will generate the same delay, or as close as possible, from the DSPI 100MHz system clock that an MPC5xx family part would generate from its 40MHz system clock. For other system clock frequencies, the customer can recompute the values using the information presented in Section 20.5.3, 'Delay Settings.'

For BITSE = 0 --&gt; 8 bits per transfer

For DT = 0 --&gt; 0.425 µ s delay: For this value, the closest value in the DSPI is 0.480 µ s

For DSCK = 0 --&gt; 1/2 SCK period: For this value, the value for the DSPI is 20ns

Table 20-33. MPC5xx QSPI Compatibility with the DSPI

| MPC5xx Family Control Bits DSPI Corresponding Control Bits   | MPC5xx Family Control Bits DSPI Corresponding Control Bits   | MPC5xx Family Control Bits DSPI Corresponding Control Bits   | MPC5xx Family Control Bits DSPI Corresponding Control Bits   | Corresponding DSPI x _CTAR Register Configuration   | Corresponding DSPI x _CTAR Register Configuration   | Corresponding DSPI x _CTAR Register Configuration   | Corresponding DSPI x _CTAR Register Configuration   | Corresponding DSPI x _CTAR Register Configuration   | Corresponding DSPI x _CTAR Register Configuration   |    |
|--------------------------------------------------------------|--------------------------------------------------------------|--------------------------------------------------------------|--------------------------------------------------------------|-----------------------------------------------------|-----------------------------------------------------|-----------------------------------------------------|-----------------------------------------------------|-----------------------------------------------------|-----------------------------------------------------|----|
| BITSE                                                        | CTAS[0]                                                      | DT CTAS[1]                                                   | DSCK CTAS[2]                                                 | DSPI x _CTAR x                                      | FMSZ                                                | PDT                                                 | DT                                                  | PCSSCK                                              | CSSCK                                               |    |
| 0                                                            |                                                              | 0                                                            | 0                                                            | 0                                                   | 0111                                                | 10                                                  | 0011                                                | 00                                                  | 0000                                                |    |
| 0                                                            |                                                              | 0                                                            | 1                                                            | 1                                                   | 0111                                                | 10                                                  | 0011                                                | User                                                | User                                                |    |
| 0                                                            |                                                              | 1                                                            | 0                                                            | 2                                                   | 0111                                                | User 1                                              | User                                                | 00                                                  | 0000                                                |    |
| 0                                                            |                                                              | 1                                                            | 1                                                            | 3                                                   | 0111                                                | User                                                | User                                                | User                                                | User                                                |    |
| 1                                                            |                                                              | 0                                                            | 0                                                            | 4                                                   | User                                                | 10                                                  | 0011                                                | 00                                                  | 0000                                                |    |
| 1                                                            |                                                              | 0                                                            | 1                                                            | 5                                                   | User                                                | 10                                                  | 0011                                                | User                                                | User                                                |    |
| 1                                                            |                                                              | 1                                                            | 0                                                            | 6                                                   | User                                                | User                                                | User                                                | 00                                                  | 0000                                                |    |
| 1                                                            |                                                              | 1                                                            | 1                                                            | 7                                                   | User                                                | User                                                | User                                                | User                                                | User                                                |    |

1 Selected by user

## 20.5.5 Calculation of FIFO Pointer Addresses

The user has complete visibility of the TX and RX FIFO contents through the FIFO registers, and valid entries can be identified through a memory mapped pointer and a memory mapped counter for each FIFO. The pointer to the first-in entry in each FIFO is memory mapped. For the TX FIFO the first-in pointer is the  transmit  next  pointer  (TXNXTPTR). For the RX FIFO the first-in pointer is the pop next pointer (POPNXTPTR). Figure 20-45 illustrates the concept of first-in and last-in FIFO entries along with the FIFO counter. The TX FIFO is chosen for the illustration, but the concepts carry over to the RX FIFO. See Section 20.4.3.4, 'Transmit First In First Out (TX FIFO) Buffering Mechanism,' and Section 20.4.3.5, 'Receive First In First Out (RX FIFO) Buffering Mechanism,' for details on the FIFO operation.

Figure 20-45. TX FIFO Pointers and Counter

<!-- image -->

## 20.5.5.1 Address Calculation for the First-in Entry and Last-in Entry in the TX FIFO

The memory address of the first-in entry in the TX FIFO is computed by the following equation:

First-in entry address = TXFIFO base + 4 (TXNXTPTR)

The memory address of the last-in entry in the TX FIFO is computed by the following equation:

Last-in entry address = TX FIFO base + 4*[(TXCTR + TXNXTPTR - 1) modulo TX FIFO depth]

where:

TX FIFO base: base address of TX FIFO

TXCTR: TX FIFO counter

TXNXTPTR: transmit next pointer

TX FIFO depth: transmit FIFO depth, implementation specific

## 20.5.5.2 Address Calculation for the First-in Entry and Last-in Entry in the RX FIFO

The memory address of the first-in entry in the RX FIFO is computed by the following equation:

First-in entry address = TX FIFO base + 4*(POPNXTPTR)

The memory address of the last-in entry in the RX FIFO is computed by the following equation:

Last-in entry address = RX FIFO base + 4*[(RXCTR + POPNXTPTR - 1) modulo RX FIFO depth] RX FIFO base: base address of RX FIFO

RXCTR: RX FIFO counter

POPNXTPTR: pop next pointer

RX FIFO depth: Receive FIFO depth, implementation specific

## 20.6 Revision History

Substantive Changes since Rev 3.0

No changes.

Deserial Serial Peripheral Interface (DSPI)
